function Server_GetSharedTaskItems(c,e){Server_ItemCall(c,"","",e,"GetSharedTaskItems")}function Server_GetDoneSharedTaskItems(c,e){Server_ItemCall(c,"","",e,"GetDoneSharedTaskItems")}function Server_ItemCall(c,e,d,f,g){c="/ItemHandler.ashx?entity=item&command="+g+"&property="+$.URLEncode(e)+"&value="+$.URLEncode(d)+"&id="+$.URLEncode(c);Server_CallByUrl(c,f)}
function Server_Call(c,e,d,f,g,h){c="/ItemHandler.ashx?entity="+c+"&command="+h+"&property="+$.URLEncode(d)+"&value="+$.URLEncode(f)+"&id="+$.URLEncode(e);Server_CallByUrl(c,g)}function Server_CallByUrl(c,e){DoRequest(("https:"==document.location.protocol?"https://":"http://")+serverUrl+c,e)}function Server_PostData(c,e,d){PostData(("https:"==document.location.protocol?"https://":"http://")+serverUrl+c,e,d)}
function DoRequest(c,e){RequestStarted();$.getJSON(c,function(c){e&&e(c);RequestEnded()})}function PostData(c,e,d){RequestStarted();$.post(c,e,function(c){d&&d(c);RequestEnded()},"json")};function CheckListItem(c){this.options=c;this.itemMenu="ItemMenu";this.SetDueDateText="Set Due Date";this.itemUnderEditing=!1;this.OnItemAdded=function(){CheckItemListForEmpty();RefreshProjectCounter(currentProjectId)};this.OnItemUpdated=function(){};this.OnItemRemoved=function(){RefreshProjectCounter(currentProjectId);CheckItemListForEmpty()};this.OnItemMoved=function(c,d,f,g){!this.SmartList.isFilterList||d==0||d==-3?($(g).remove(),CheckItemListForEmpty()):this.RefreshProjectTag(this.SmartList.DataListById[c],
this.SmartList.GetLiDivById(c),f)};this.OnItemEditing=function(c){c=this.SmartList.GetLiDivById(c);c.find(".ItemDueDate:first").hide();c.find(".FilterItemProjectDiv:first").hide();c.find("#ItemNotesBtn:first").hide();this.itemUnderEditing=!0};this.OnItemEdited=function(c){this.itemUnderEditing=!1;var d=this.SmartList.GetLiDivById(c),f=d.find(".ItemDueDateInner:first").html();f!=""&&f!=this.SetDueDateText&&d.find(".ItemDueDate:first").show();c=this.SmartList.DataListById[c];this.CheckSpecialKeysInContent(c,
d);this.RefreshProjectTag(c,d);this.RefreshNotes(c,d)};this.CheckSpecialKeysInContent=function(c,d){var f=d.find("#ItemCheckDiv:first"),g=d.find("."+this.SmartList.contentHolder+":first");c.Content.beginsWith("*",!0)?(f.hide(),g.html(htmlEncodeWithLinks(c.Content.substring(1))),g.hasClass("ItemContentDivBold")||g.addClass("ItemContentDivBold")):(f.show(),g.removeClass("ItemContentDivBold"))};this.OnAddingItem=function(c,d){d.find("."+this.SmartList.contentHolder).attr("itemId",c.Id);c.Content.beginsWith("*",
!0)?this.CheckSpecialKeysInContent(c,d):(d.find("."+this.SmartList.contentHolder).html(htmlEncodeWithLinks(c.Content)),d.find("#ItemCheckBox").attr("itemId",c.Id),d.find("#ItemCheckBox").attr("checked",!1),c.Checked&&(d.find("#ItemCheckBox").attr("checked",c.Checked),d.find("."+this.SmartList.contentHolder).addClass("DoneItem")));this.InitNotes(c,d);var f=!this.SmartList.isFilterList&&userData.ListSortType==0;d.find(".handle").attr("src",f?"/Images/grippy.png":"/Images/grippy2.png");this.SetItemColor(c.Priority,
d);this.RefreshDueDate(c,d);this.RefreshProjectTag(c,d);this.RefreshNotes(c,d);this.BindEvents(d)};this.SetItemColor=function(c,d){d.find("."+this.SmartList.contentHolder+":first").css("color",PriorityColorArray[c-1]);d.find("."+this.SmartList.contentHolder+":first").css("font-weight",c!=4?"bold":"")};this.RefreshDueDate=function(c,d){c.DateString&&!IsEmpty(c.DateString)?(d.find(".ItemDueDate:first").css("display","block"),d.find(".ItemDueDateInner:first").html(c.DateString)):d.find(".ItemDueDate:first").hide();
d.find(".ItemDueDate:first").removeClass("ItemDueDate_p0").removeClass("ItemDueDate_p1").removeClass("ItemDueDate_p2").addClass("ItemDueDate_p"+c.DateStringPriority);d.find(".ItemDueDateInner:first").removeClass("ItemDueDateInner_pp0").removeClass("ItemDueDateInner_pp1").removeClass("ItemDueDateInner_pp2").addClass("ItemDueDateInner_pp"+c.DateStringPriority)};this.RefreshProjectTag=function(c,d,f){var g=f!=void 0?f:c.ProjectId,c=c.ProjectId!=void 0&&this.SmartList.isFilterList&&uiSettings.ShowFilterProjectTag,
d=d.find("#FilterItemProjectDiv");c?(d.css("display","block"),c=GetProjectData(g),c!=void 0?(d.html(c.Content),d.unbind("click"),d.bind("click",function(){SelectProjectById(g)})):d.hide()):d.css("display","none")};this.BindEvents=function(c){var d=this,f=c.find(".LiDiv:first"),g=c.attr("itemId");uiSettings.ShowMenuOnRightClick&&f.bind("contextmenu",function(c){d.OnContextMenu(c,this)});f.bind("mouseover",function(){d.OnMouseOver(this)});f.bind("mouseout",function(){d.OnMouseOut(this)});f.find("#ItemCheckBox:first").bind("click",
function(){d.OnChecked(this)});f.find(".ItemDueDate").bind("click",function(c){d.OnEditDueDate(c,this)});f.find("#ItemNotesBtn").bind("click",function(){d.NotesIconClicked(f,g)});uiSettings.EditNotesOnClick&&f.find("#LiNotesSpan"+g).bind("click",function(c){d.EditNotes(g,c)});f.find("#LiNotesSpan"+g).bind("keydown",function(c){d.EditNotesKeyDown(c,g)})};this.OnMouseOver=function(c){var d=$(c);d.find(".ItemMenu").show();c=$(c).attr("itemId");!d.find(".ItemDueDate:first").is(":visible")&&this.SmartList.itemUnderEditingId!=
c&&(d.find(".ItemDueDate:first").show(),d.find(".ItemDueDateInner:first").html(this.SetDueDateText),d.find(".ItemDueDate:first").addClass("ItemDueDateSet"),d.find(".FilterItemProjectDiv:first").hide());this.SmartList.itemUnderEditingId!=c&&d.find("#ItemNotesBtn:first").show()};this.OnMouseOut=function(c){var d=$(c);(this.SmartList.menuOpenedOnElement==void 0||$(c).attr("itemId")!=$(this.SmartList.menuOpenedOnElement).attr("itemId"))&&d.find(".ItemMenu").hide();(this.EditDueDatePanel==void 0||!this.EditDueDatePanel.is(":visible"))&&
this.CheckAndHideDueDate(d);this.RefreshNotes(this.SmartList.DataListById[$(c).attr("itemId")],d)};this.CheckAndHideDueDate=function(c){c.find(".ItemDueDateInner:first").html()==this.SetDueDateText&&(c.find(".ItemDueDate:first").hide(),c.find(".ItemDueDate:first").removeClass("ItemDueDateSet"),c.find(".FilterItemProjectDiv:first").html()!=""&&this.SmartList.isFilterList&&uiSettings.ShowFilterProjectTag&&c.find(".FilterItemProjectDiv:first").show())};this.OnContextMenu=function(c,d){var f=$(d);f.find("."+
this.itemMenu).show();f.find("."+this.itemMenu).mousedown();f.find("."+this.itemMenu).mouseup();c.preventDefault();return!1};this.OnMenuClicked=function(c,d){var f=this,g=$(d).attr("itemId");c=="delete"&&Client.DeleteItemById(g,function(){f.SmartList.RemoveItemFromList(g);RefreshFilterCounts();DisplayInfo("Item has been Deleted")});if(c=="done"){var h={Checked:!0};Client.UpdateItemById(h,g,function(c){f.MoveItemToDone(g,c);RefreshFilterCounts()});h=ItemList.GetLiById(g);h.find("."+this.SmartList.contentHolder+
":first").addClass("DoneItem")}c=="edit"&&this.SmartList.EditItemText($(".ItemContentDiv[itemId="+g+"]"));c=="editNotes"&&this.ShowAndEditNotes(this.SmartList.GetLiDivById(g),g);if(c=="removeNotes"&&(h=this.SmartList.DataListById[g],h.Notes&&!IsEmpty(h.Notes)&&confirm("Do you really want to remove the Notes of this item?")))h={},h.Notes="",Client.UpdateItemById(h,g,function(c){f.SmartList.DataListById[g]=c;f.RefreshNotes(c,f.SmartList.GetLiDivById(g),!0)});c=="addBelow"&&(h=ItemList.GetLiById(g),
this.SmartList.AddItemBelowAbove(h,!0));c=="addAbove"&&(h=ItemList.GetLiById(g),this.SmartList.AddItemBelowAbove(h,!1));if(c.substring(4,0)=="icon"){var j=c.substring(4),h={};h.Priority=j;Client.UpdateItemById(h,g,function(){var c=ItemList.GetLiById(g);f.SetItemColor(j,c)})}this.SmartList.menuOpenedOnElement=void 0;d.hide()};this.OnChecked=function(c){var d=this,f=$(c).attr("itemId"),g=this.SmartList.GetLiById(f).find("."+this.SmartList.contentHolder+":first");if($(c).attr("checked")=="checked"&&
!this.isBeingRemoved){c=this.SmartList.DataListById[f];this.isBeingRemoved=!0;var h={Checked:!0};Client.UpdateItemById(h,f,function(){Client.GetDoneRootItemById(f,function(c){d.MoveItemToDone(f,c);RefreshFilterCounts()})});g.addClass("DoneItem")}else if(!this.isBeingRemoved&&(c=this.SmartList.DataListById[f],c.Checked=!1,c=this.UpdateItemTypeRecursively(c,1),this.SmartList.DataListById[f]=c,h={},h.Checked=!1,Client.UpdateItemById(h,f),g.removeClass("DoneItem"),this.SmartList.DataListById[f]=c,RefreshFilterCounts(),
currentProjectId==-4))this.isBeingRemoved=!0,this.SmartList.RemoveItemFromList(c.Id)};this.MoveItemToDone=function(c,d){var f=this.SmartList.DataListById[c];f.Checked=!0;f=this.UpdateItemTypeRecursively(f,3);this.SmartList.DataListById[c]=f;this.SmartList.RemoveItemFromList(f.Id);this.SmartList.ConnectedDoneList&&this.SmartList.ConnectedDoneList.AddOrOverwriteItem(d)};this.UpdateItemTypeRecursively=function(c,d){c.ItemType=d;for(var f=0;f<c.Children.length;f++)c.Children[f]=this.UpdateItemTypeRecursively(c.Children[f],
d);return this.SmartList.DataListById[c.Id]=c};this.OnEditDueDate=function(c,d){var f=$(d).attr("itemId");this.ShowEditDueDate(d,f);CancelEventBubble(c)};this.ShowEditDueDate=function(c,d){var f=this,g=!0;if(this.EditDueDatePanel!=void 0&&this.EditDueDatePanel.is(":visible"))this.HideAllDueDatePanels();else{var h=this.SmartList.GetLiById(d);h.find(".ItemDueDate:first").show();var j=h.position();this.HideAllDueDatePanels();var k=this.SmartList.DataListById[d],g=k==void 0||k.DueDate==void 0||k.DueDate==
"";if(this.EditDueDatePanel==void 0){this.EditDueDatePanel=$("#EditDueDate").clone();this.EditDueDatePanel.attr("id","EditDueDate"+d);this.EditDueDatePanel.attr("itemId",d);var l=this.EditDueDatePanel.find("#EditDueDateCalendar"),o="EditDueDateCalendar"+d;l.attr("id",o);this.EditDueDatePanel.dueDateId=o;l.datetimepicker({dateFormat:"dd M y",timeFormat:"hh:mm tt",showButtonPanel:!1,minuteGrid:15,firstDay:userData.FirstDayOfWeek,beforeShow:function(){f.datePickerBeingShown=!0},onClose:function(){f.datePickerBeingShown=
!1},onSelect:function(){f.SelectedDueDate(f.EditDueDatePanel)}});this.EditDueDatePanel.find("#LinkShowDueDateAdv").bind("click",function(){f.ShowEditDueDateAdv(f.EditDueDatePanel)});this.EditDueDatePanel.find("#LinkShowDueDateSave").bind("click",function(){f.SaveEditDueDate(f.EditDueDatePanel)});this.EditDueDatePanel.find("#SelectRepeatType").bind("change",function(){f.OnRepeatTypeChanged(f.EditDueDatePanel,this)});this.EditDueDatePanel.find(".PostponeBtnDiv").bind("click",function(){f.Postpone(f.EditDueDatePanel)});
this.EditDueDatePanel.find("#DaySelect").bind("click",function(c){c.stopPropagation(f.EditDueDatePanel)});this.EditDueDatePanel.find("#EditDueDateAdvDate").bind("keypress",function(c){f.OnDueDateKeyPress(c,f.EditDueDatePanel)});k!=void 0&&this.LoadEditDueDate(this.EditDueDatePanel,k);$("#HiddenDiv").append(this.EditDueDatePanel)}else l=this.EditDueDatePanel.find("#EditDueDateCalendar"+d),l.datetimepicker("option","firstDay",userData.FirstDayOfWeek);$(document).bind("click",function(c){f.PostponeClickOut(c,
d,f.EditDueDatePanel)});this.EditDueDatePanel.find(".EditDueDatePostpone").toggle(!g);g=j.left-this.EditDueDatePanel.width()+$(h).width()-28;j=j.top+24;this.EditDueDatePanel.css("left",g);this.EditDueDatePanel.css("top",j);this.ShowEditDueDateAdv(this.EditDueDatePanel,!0);var f=this;this.EditDueDatePanel.show("fast",function(){$.browser.msie||f.EditDueDatePanel.find("#EditDueDateAdvDate").clearableTextField();f.EditDueDatePanel.find("#EditDueDateAdvDate").focus()})}};this.LoadEditDueDate=function(c,
d){var f=d.Recurrence,g=ParseDate(d.DueDate);c.find("#"+c.dueDateId).datetimepicker("setDate",g);if(g!=void 0)c.dateTime=g,c.find("#EditDueDateAdvDate").val(formatDueDate(c.dateTime));f!=void 0&&(c.find("#SelectRepeatType").val(f.RepeatType),c.find("#SelectDays").val(f.SelectDays),c.find("#SelectWeeks").val(f.SelectWeeks),c.find("#WeekDay0").attr("checked",f.Weekday0),c.find("#WeekDay1").attr("checked",f.Weekday1),c.find("#WeekDay2").attr("checked",f.Weekday2),c.find("#WeekDay3").attr("checked",f.Weekday3),
c.find("#WeekDay4").attr("checked",f.Weekday4),c.find("#WeekDay5").attr("checked",f.Weekday5),c.find("#WeekDay6").attr("checked",f.Weekday6),c.find("#SelectMonths").val(f.SelectMonths),c.find("#BYMONTHDAY").attr("checked",f.MonthByMonthDay),c.find("#BYDAY").attr("checked",f.MonthByDay),c.find("#SelectYears").val(f.SelectYears));this.OnRepeatTypeChanged(c,c.find("#SelectRepeatType"))};this.SelectedDueDate=function(c){var d=c.find("#"+c.dueDateId).datetimepicker("getDate");c.dateTime=d;d=formatDueDate(c.dateTime);
c.find("#EditDueDateAdvDate").val(d)};this.SaveEditDueDate=function(c){var d=c.find("#EditDueDateAdvDate").val(),d=ParseDate(d);this.SaveEditDueDate2(c,d)};this.SaveEditDueDate2=function(c,d){thisRef=this;var f=GetRecurrenceFromPanel(c);f.DueDate=d;if(d==null&&!IsEmpty(f.DueDate))AlertInvalidDate();else{if(d!=null)f.DueDate=d.toString("M/d/yyyy HH:mm");var g=c.attr("itemId");this.HideDueDate(c);var h=this.SmartList.GetLiById(g),j=h.find(".ItemDueDateInner:first");h.find(".ItemDueDate:first").removeClass("ItemDueDateSet");
j.html("Loading..");j={};j.DueDate=f.DueDate;j.DueTimeSpecified=!0;if(j.DueDate==void 0)j.DueDate="";Client.UpdateItemById(j,g,function(c){thisRef.SmartList.DataListById[g]=c;thisRef.RefreshDueDate(c,h);thisRef.RefreshProjectTag(c,h);thisRef.EditDueDatePanel.remove();thisRef.EditDueDatePanel=void 0;thisRef.CheckIfRemoveNeeded(c,h,function(){RefreshFilterCounts()},!1,d)})}};this.Postpone=function(c){thisRef=this;var d=c.find("#DaySelect").val(),f=c.attr("itemId");this.HideDueDate(c);var g=this.SmartList.GetLiById(f),
c=g.find(".ItemDueDateInner:first");g.find(".ItemDueDate:first").removeClass("ItemDueDateSet");c.html("Loading..");Client.PostponeItem(d,f,function(c){thisRef.SmartList.DataListById[f]=c;thisRef.RefreshDueDate(c,g);thisRef.EditDueDatePanel.remove();thisRef.EditDueDatePanel=void 0;thisRef.CheckIfRemoveNeeded(c,g,function(){RefreshFilterCounts()},!0)})};this.CheckIfRemoveNeeded=function(c,d,f,g,h){d=!1;currentProjectId<=0?(currentProjectId==-1&&(g||h!=void 0&&h.compareTo(Date.parse("tomorrow"))!=-1?
d=!0:!g&&h==void 0&&(d=!0)),currentProjectId==-5&&(!g&&h!=void 0&&h.compareTo(Date.parse("tomorrow"))==-1?d=!0:!g&&h==void 0&&(d=!0)),currentProjectId==0&&(d=!0),d&&this.SmartList.RemoveItemFromList(c.Id,f)):f&&f()};this.ShowEditDueDateAdv=function(c,d){if(!d){userData.EditDueDateMoreExpanded=!userData.EditDueDateMoreExpanded;var f={};f.EditDueDateMoreExpanded=userData.EditDueDateMoreExpanded;Client.UpdateUser(f)}thisRef=this;userData.EditDueDateMoreExpanded?c.find("#EditDueDateAdv").slideDown("fast",
function(){thisRef.UpdateEditDueDateAdv(c)}):c.find("#EditDueDateAdv").slideUp("fast",function(){thisRef.UpdateEditDueDateAdv(c)})};this.UpdateEditDueDateAdv=function(c){userData.EditDueDateMoreExpanded?c.find("#DueDatePopupMore").attr("src","/Images/DueDatePopupLess.png"):c.find("#DueDatePopupMore").attr("src","/Images/DueDatePopupMore.png")};this.OnMouseOutPostponePanel=function(c){thisRef=this;this.postponePanelTime=setTimeout(function(){thisRef.datePickerBeingShown||thisRef.HideDueDate(c)},2E3)};
this.OnMouseOverPostponePanel=function(){clearTimeout(this.postponePanelTime)};this.OnDueDateKeyPress=function(c,d){if(typeof c!="undefined"&&c.keyCode==13)return CancelEventBubble(c),this.SaveEditDueDate(d),!1};this.OnDueDateKeyDown=function(c){if(typeof c!="undefined"&&c.keyCode==13)return c.returnValue=!1,c.cancel=!0,c.cancelBubble=!0,c.stopPropagation(),!1};this.HideDueDate=function(c){c!=void 0&&(c.hide(),clearTimeout(this.postponePanelTime),this.CheckAndHideDueDate(this.SmartList.GetLiById(c.attr("itemId"))))};
this.HideAllDueDatePanels=function(){HideAllMenus(!0);clearTimeout(this.postponePanelTime);$(document).unbind("click");$(".ItemDueDateInner:contains('"+this.SetDueDateText+"')").parent().hide().removeClass("ItemDueDateSet")};this.PostponeClickOut=function(c,d,f){var g=$(c.target),h=g.parents("#EditDueDate"+d);g.attr("itemId")!=d&&(h.length==0||h.attr("itemId")!=d)&&g.parents(".ui-datepicker").length==0&&g.parents(".ui-datepicker-calendar").length==0&&g.parents(".ui-datepicker-header").length==0&&
!g.hasClass("text_clear_button")&&g.parents(".ui-dialog").length==0&&!g.hasClass(".ui-widget-overlay")&&(!g.hasClass("InputBtnAdd")||c.clientX!=0||c.clientY!=0)&&this.HideDueDate(f)};this.OnRepeatTypeChanged=function(c,d){c.find("#RecDivDaily").hide();c.find("#RecDivWeekly").hide();c.find("#RecDivMonthly").hide();c.find("#RecDivYearly").hide();var f=$(d).val();f==1?c.find("#RecDivDaily").show():f==2?c.find("#RecDivWeekly").show():f==3?c.find("#RecDivMonthly").show():f==4&&c.find("#RecDivYearly").show()};
this.InitNotes=function(c,d){var f=d.find("#LiNotesSpan:first").attr("id","LiNotesSpan"+c.Id);c.Notes&&!IsEmpty(c.Notes)&&(this.SetNotesHtml(f,c),showNotes&&d.find("#LiNotes:first").show())};this.NotesIconClicked=function(c,d){if(c.find("#LiNotes:first").is(":visible"))c.find("#LiNotes:first").hide();else{c.find("#LiNotes:first").show();var f=this.SmartList.DataListById[d];if(!f.Notes||IsEmpty(f.Notes))userData.IsProUser?this.EditNotes(d):(c.find("#LiNotes:first").hide(),this.ShowNotesNoPro(d))}};
this.ShowAndEditNotes=function(c,d){c.find("#LiNotes:first").show();userData.IsProUser?this.EditNotes(d):(c.find("#LiNotes:first").hide(),this.ShowNotesNoPro(d))};this.RefreshNotes=function(c,d,f){if(!(this.itemUnderEditing||c==void 0)){var g=this.GetNotesSpan(c.Id);c.Notes&&!IsEmpty(c.Notes)?d.find("#ItemNotesBtn:first").css("display","block"):(d.find("#ItemNotesBtn:first").hide(),f&&(d.find("#LiNotes:first").hide(),g=this.GetNotesSpan(c.Id),g.html("")))}};this.EditNotes=function(c){var d=this,f=
this.GetNotesSpan(c);if(!f.hasClass("LiNotesSpanEdit"))if(userData.IsProUser)if(myNicEditor.addInstance("LiNotesSpan"+c),f.addClass("LiNotesSpanEdit"),f.focus(),f.unbind("blur"),f.bind("blur",function(){setTimeout(function(){d.SaveEditNotes(c)},200)}),f.parent().find("#LiNotesEditIcons").length==0){var g=$("#InvisibleHolder").find("#LiNotesEditIcons").clone();f.parent().add(g);g.insertBefore(".LiNotesSpanEdit");g.find("#ImgLiNotesCancel").bind("click",function(){d.CancelEditNotes(c)})}else f.parent().find("#LiNotesEditIcons").show();
else this.ShowNotesNoPro(c)};this.ShowNotesNoPro=function(){userData.IsProUser||alert("Only Pro Users can add or edit Notes. Please Upgrade to Pro for Great Features!")};this.SaveEditNotes=function(c){var d=this,f=this.GetNotesSpan(c),g=f.html(),g=$.trim(g);isHtmlBoxEmpty(f)&&(g="");this.SmartList.DataListById[c].Notes!=g?(f={},f.Notes=g,Client.UpdateItemById(f,c,function(f){d.SmartList.DataListById[c]=f;d.RefreshNotes(f,d.SmartList.GetLiDivById(c));d.CancelEditNotes(c)})):this.CancelEditNotes(c)};
this.CancelEditNotes=function(c){var d=this.GetNotesSpan(c);d.hasClass("LiNotesSpanEdit")&&(myNicEditor.removeInstance("LiNotesSpan"+c),d.removeClass("LiNotesSpanEdit"),d.unbind("blur"),d.parent().find("#LiNotesEditIcons").hide());var f=this.SmartList.DataListById[c];(!f.Notes||IsEmpty(f.Notes))&&this.SmartList.GetLiDivById(c).find("#LiNotes:first").hide();this.SetNotesHtml(d,f)};this.EditNotesKeyDown=function(c,d){if(typeof c!="undefined"&&c.keyCode==13)c.ctrlKey==1&&this.SaveEditNotes(d);else if(typeof c!=
"undefined"&&c.keyCode==27)return this.CancelEditNotes(d),c.returnValue=!1,c.cancel=!0,!1};this.SetNotesHtml=function(c,d){c.html(d.Notes);c.find("a").attr("target","_blank");c.find("a").bind("click",function(c){c.stopPropagation()})};this.GetNotesSpan=function(c){return $("#LiNotesSpan"+c)}};function DoneListItem(c){this.options=c;this.OnItemAdded=function(){currentProjectInfo.DoneItemsCount++;UpdateItemsInfo()};this.OnItemRemoved=function(){currentProjectInfo.DoneItemsCount--;UpdateItemsInfo()};this.OnAddingItem=function(c,d){d.find(".handle").hide();d.find(".LiDiv").attr("onmouseover","");d.find(".LiDiv").attr("onmouseout","");d.find(".LiDiv").attr("onclick","");d.find(".LiDiv").attr("onContextMenu","");d.find("."+this.SmartList.contentHolder).attr("onclick","");d.find("."+this.SmartList.contentHolder).attr("itemId",
c.Id);d.find("."+this.SmartList.contentHolder).html(htmlEncodeWithLinks(c.Content));d.find("#ItemCheckBox").attr("itemId",c.Id);d.find("#ItemCheckBox").attr("checked",!1);c.Checked&&(d.find("#ItemCheckBox").attr("checked",c.Checked),d.find("."+this.SmartList.contentHolder).addClass("DoneItem"));this.InitNotes(c,d);this.RefreshNotes(c,d);this.BindEvents(d)};this.BindEvents=function(c){var d=this,f=c.find(".LiDiv:first");f.find("#ItemCheckBox:first").bind("click",function(){d.OnChecked(this)});f.find("#ItemNotesBtn").bind("click",
function(){d.NotesIconClicked(f,id)})};this.OnChecked=function(c){var d=this,f=$(c).attr("itemId"),g=this.SmartList.GetLiById(f).find("."+this.SmartList.contentHolder+":first");if($(c).attr("checked")!="checked"&&!this.isBeingRemoved)this.isBeingRemoved=!0,c={Checked:!1},Client.UpdateItemById(c,f,function(){Client.GetDoneRootItemById(f,function(c){d.MoveDoneItemBack(f,c);RefreshFilterCounts()})}),g.removeClass("DoneItem");else if(!this.isBeingRemoved)c={},c.Checked=!0,Client.UpdateItemById(c,f)};
this.MoveDoneItemBack=function(c,d){var f=this,g=this.SmartList.DataListById[c];g.Checked=!1;g=this.UpdateItemTypeRecursively(g,1);d!=void 0&&d!=""&&d!=null&&d.Id!=void 0?(this.SmartList.RemoveItemFromList(g.Id),this.SmartList.AddOrOverwriteItem(d)):this.SmartList.RemoveItemFromList(this.GetRootItemId(c));this.SmartList.ConnectedItemList&&Client.GetRootItemById(c,function(c){f.SmartList.ConnectedItemList.AddOrOverwriteItem(c)})};this.GetRootItemId=function(c){var d=this.SmartList.DataListById[c];
if(d!=null&&d.ParentId!=null)return this.GetRootItemId(d.ParentId);return c};this.UpdateItemTypeRecursively=function(c,d){c.ItemType=d;for(var f=0;f<c.Children.length;f++)c.Children[f]=this.UpdateItemTypeRecursively(c.Children[f],d);return this.SmartList.DataListById[c.Id]=c};this.InitNotes=function(c,d){d.find("#LiNotes:first").addClass("LiNotes2");d.find("#ItemNotesBtn:first").addClass("ItemNotesBtn2");var f=d.find("#LiNotesSpan:first").attr("id","LiNotesSpan"+c.Id);c.Notes&&!IsEmpty(c.Notes)&&
(this.SetNotesHtml(f,c),showNotes&&d.find("#LiNotes:first").show())};this.RefreshNotes=function(c,d){this.itemUnderEditing||(this.GetNotesSpan(c.Id),c.Notes&&!IsEmpty(c.Notes)?d.find("#ItemNotesBtn:first").css("display","block"):d.find("#ItemNotesBtn:first").hide())};this.NotesIconClicked=function(c){c.find("#LiNotes:first").is(":visible")?c.find("#LiNotes:first").hide():c.find("#LiNotes:first").show()};this.SetNotesHtml=function(c,d){c.html(d.Notes);c.find("a").attr("target","_blank");c.find("a").bind("click",
function(c){c.stopPropagation()})};this.GetNotesSpan=function(c){return $("#LiNotesSpan"+c)}};function DeletedListItem(c){this.options=c;this.OnAddingItem=function(c,d){d.find(".handle").attr("src","/Images/grippy2.png");d.find(".LiDiv").attr("onmouseover","");d.find(".LiDiv").attr("onmouseout","");d.find(".LiDiv").attr("onclick","");d.find(".LiDiv").attr("onContextMenu","");d.find("."+this.SmartList.contentHolder).attr("onclick","");d.find("."+this.SmartList.contentHolder).attr("itemId",c.Id);d.find("."+this.SmartList.contentHolder).html(htmlEncodeWithLinks(c.Content));d.find("#ItemCheckBox").attr("itemId",
c.Id);d.find("#ItemCheckBox").attr("checked",!1);d.find("#ItemCheckBox").attr("disabled",!0);c.Checked&&(d.find("#ItemCheckBox").attr("checked",c.Checked),d.find("."+this.SmartList.contentHolder).addClass("DoneItem"));this.BindEvents(d)};this.OnItemMoved=function(c,d,f,g){$(g).remove();CheckItemListForEmpty()};this.BindEvents=function(c){var d=this;c.find(".LiDiv:first").find("#ItemCheckBox:first").bind("click",function(){d.OnChecked(this)})}};function FilterListItem(c){this.options=c;this.OnAddingItem=function(c,d){d.find(".FilterItemContent").html(htmlEncode(c.Content));d.find(".FilterItemContent").attr("itemId",c.Id);d.find(".ListCount").html(c.ItemsCount);d.find(".ListCount").attr("itemId",c.Id);c.ItemsCount==0&&d.find(".ListCount").hide();SetFilterIcon(d,c.Icon);this.BindEvents(d)};this.BindEvents=function(c){var d=this,c=c.find(".LiDiv:first");c.bind("mouseover",function(){d.OnMouseOver(this)});c.bind("mouseout",function(){d.OnMouseOut(this)})};
this.OnMouseOver=function(c){c=$(c);c.find("."+this.SmartList.itemMenu).length!=0&&(c.find("."+this.SmartList.itemMenu).show(),c.find(".ListCount").hide())};this.OnMouseOut=function(c){if(this.SmartList.menuOpenedOnElement==void 0||$(c).attr("itemId")!=$(this.SmartList.menuOpenedOnElement).attr("itemId"))c=$(c),c.find("."+this.SmartList.itemMenu).hide(),c.find(".ListCount").html()!="0"&&c.find(".ListCount").show()};this.OnMenuClicked=function(c,d){$(d).attr("itemId");c=="emptyRecycle"&&Client.DeleteRecycleBinItems(function(){RefreshCurrentProject();
RefreshFilterCounts();DisplayInfo("Recycle Bin has been Emptied.")});this.SmartList.menuOpenedOnElement=void 0;d.hide()};this.OnMenuClosed=function(c){var d=$(c).attr("itemId"),c=this.SmartList.GetLiDivById(d),d=this.SmartList.DataListById[d];c.find(".ListCount").toggle(d.ItemsCount!=0)}};function InitFilters(){var c=$("#FilterList").clone().attr("id","mainFilterList"),e=$("#OtherList").clone().attr("id","mainOtherList");$("#FilterListPlaceHolder").append(c);$("#OtherListPlaceHolder").append(e);FilterList=new SmartList({list:c,itemLi:"BaseFilterLi",entityType:"filter",contentHolder:"FilterItemContent",noUrlInContent:!0,isFilterList:!0});OtherList=new SmartList({list:e,itemLi:"BaseFilterLi",entityType:"filter",contentHolder:"FilterItemContent",itemMenu:"ProjItemMenu",itemContextMenu:"recycleContextMenu",
dropableType:"BaseItemLi",acceptItemLi:"acceptBoth",noUrlInContent:!0,isFilterList:!0});RegisterList(FilterList.list.attr("id"),FilterList);RegisterList(OtherList.list.attr("id"),OtherList)}function LoadFiltersByData(c){FilterList.LoadItems(c.Filters);OtherList.LoadItems(c.Others)}function SetFilterIcon(c,e){c.find(".ListIcon:first").attr("style","background: url(Images/icons/"+IconArray[e]+") no-repeat;")}
function FilterSelected(c){var e=$(c).attr("itemId");e!=currentProjectId&&(currentSelectedList=e==-3?OtherList:e<=0&&e>-6?FilterList:SharedTasksList,ClearAllProjectSelection(),$(c).addClass("ProjectSelected"),currentProjectId=e,LoadItems(e,!0))}
function RefreshFilterCounts(){Client.GetAllFilters(function(c){for(var e=0;e<c.length;e++){var d=c[e].Id,d=e==c.length-1?OtherList.GetLiById(d):FilterList.GetLiById(d);d.find(".ListCount").html(c[e].ItemsCount);c[e].ItemsCount==0?d.find(".ListCount").hide():d.find(".ListCount").show()}})};function LoadSharesByData(c){c.SharedProjectsWaitingForApproval!=null&&c.SharedProjectsWaitingForApproval.length>0&&ShowShareNotification(c.SharedProjectsWaitingForApproval)}function RefreshShares(){Client.GetPendingShares(function(c){c!=null&&c.length>0&&ShowShareNotification(c)})}
function SharedUserTaskListSelected(c){var e=$(c).attr("itemId");e!=currentProjectId&&(currentSelectedList=SharedTasksList,ClearAllProjectSelection(),$(c).addClass("ProjectSelected"),currentProjectId=e,LoadSharedTaskItems(e,!0))}
function BindShareNotifSettings(c,e,d){e.empty();for(var f=0;f<c.length;f++){var g=d.clone();c[f].ProjectShareOwnerName?g.find("#SetShareName").text(c[f].ProjectShareOwnerName):g.find("#SetShareName").text(c[f].ProjectShareOwnerEmail);g.find("#SetShareName").attr("title",c[f].ProjectShareOwnerEmail);g.find("#SetShareProject").text(c[f].Content);g.find("#SetShareProject").attr("title",c[f].Content);SetSettingsShareEnabled(g.find("#SetShareEnabled"),c[f].IsShareApproved);g.find("#SetShareEnabled").attr("projectId",
c[f].Id);g.find("#SetShareIcon").attr("style","background: url(Images/icons/"+IconArray[c[f].Icon]+") no-repeat;");e.append(g)}}
function ShowShareNotification(c){var e=$("#shareNotificationDialog").clone();BindShareNotifSettings(c,e.find("#SettingsSharedWithMeList"),$("#SetShareLiAppr"));e.dialog({bgiframe:!0,modal:!0,draggable:!1,resizable:!1,width:530,dialogClass:"alert",buttons:{"Approve all":function(){var c=this;Client.ApproveAllPendingShares(function(){$(c).dialog("close");ReloadThings()})},"Decline all":function(){var c=this;Client.DeclineAllPendingShares(function(){$(c).dialog("close")})},"Go to Settings":function(){$(this).dialog("close");
OpenSettingsDialog("#settings_sharePanel")}}})};function InitItems(){var c=$("#ItemsList").clone().attr("id","mainItemList"),e=$("#DoneItemsList").clone().attr("id","mainDoneItemList");$("#ItemListPlaceHolder").append(c);$("#DoneItemListPlaceholder").append(e);ItemList=new SmartList({list:c,itemLi:"BaseItemLi",itemLiTemp:$("#ItemsList"),entityType:"item",contentHolder:"ItemContentDiv",addItemLi:"AddItemLi",itemMenu:"ItemMenu",itemContextMenu:"itemContextMenu",itemEditDiv:"ItemEditDiv",acceptItemLi:"acceptItem",menuToLeft:!0,GetSerializedList:GetSerializedItemList});
DoneItemList=new SmartList({list:e,itemLi:"BaseItemLi",itemLiTemp:$("#ItemsList"),entityType:"item",contentHolder:"ItemContentDiv",addItemLi:"AddItemLi",itemMenu:"ItemMenu",itemContextMenu:"itemContextMenu",itemEditDiv:"ItemEditDiv"});DoneItemList.ConnectedItemList=ItemList;ItemList.ConnectedDoneList=DoneItemList;RegisterList(ItemList.list.attr("id"),ItemList);RegisterList(DoneItemList.list.attr("id"),DoneItemList)}
function LoadItems(c,e){Client.GetItemsOfProjectWithInfo(c,function(d){LoadItemsByData(d,c,e)})}function LoadSharedTaskItems(c,e){Server_GetSharedTaskItems(c,function(d){LoadItemsByData(d,c,e)})}
function LoadItemsByData(c,e,d){ItemList.isFilterList=d;ItemList.LoadItems(c.Items);$(DoneItemList.list).empty();d=currentSelectedList.DataListById[e];DisplayProjectTitle(d,d!=void 0?d.Content:"");CheckItemListForEmpty();currentProjectInfo=c.Info;UpdateItemsInfo(!0);$("#MainContentTasks").show();$("#MainContentSharedRoot").hide();e==-6?($("#MainContentTasks").hide(),$("#MainContentSharedRoot").show()):e==-4||e==-3?($("#DoneItemsDiv").hide(),$("#AddNewItemDiv").hide(),$("#AddItemWhenHidden").show()):
($("#DoneItemsDiv").show(),$("#AddNewItemDiv").show(),$("#AddItemWhenHidden").hide())}
function AddNewItem(){$("#AddItemAdvDate").datetimepicker("hide");var c=$("#NewItemContentInput").val();if(c&&c.replace(/\s/g,"")!=""){var e=$("#AddItemAdvDate").val(),d=$("#AddItemNotesSpan").html();isHtmlBoxEmpty($("#AddItemNotesSpan"))&&(d=void 0);var f=GetRecurrenceFromPanel($("#AddItemAdvPanel:first"));f.DueDate=e;e=ParseDate(f.DueDate);if(e==null&&!IsEmpty(f.DueDate))AlertInvalidDate();else{$("#NewItemContentInput").attr("readonly",!0);$("#NewItemAddButton").attr("disabled",!0);if(e!=null)f.DueDate=
e.toString("M/d/yyyy HH:mm");e={};e.Content=c;e.ProjectId=currentProjectId;e.DueDate=f.DueDate;if(userData.IsProUser)e.Notes=d;Client.CreateItem(e,function(c){ItemList.AddNewItem(c);AddItemFinished()})}}}
function AddItemFinished(){$("#NewItemContentInput").removeAttr("readonly");$("#NewItemAddButton").removeAttr("disabled");$("#NewItemContentInput").val("");ResetRecurrencePanel($("#AddItemAdvPanel:first"));$("#AddItemAdvDate").val("").addClass("InputTextAddItemDueDateWatermark");$("#AddItemNotesSpan").html("").addClass(NotesWaterMarkClass);RepeatTypeChange();$("#NewItemContentInput").focus();RefreshFilterCounts()}
function ItemAddKeyDown(c){if(typeof c!="undefined"&&c.keyCode==13&&c.shiftKey!=1)return c.returnValue=!1,c.cancel=!0,AddNewItem($("#NewItemContentInput").val()),!1}function HideDoneItems(){$("#DoneItemsShowLink").html("See all");$("#DoneItemsShowLink").attr("showAll","false");$("#DoneItemsHideLink").hide();DoneItemList.ClearList()}
function DeleteDoneItems(){currentProjectId>0&&confirm("Do you really want to delete all the done items?")&&($("#DoneItemsShowLink").html("See all"),$("#DoneItemsShowLink").attr("showAll","false"),DoneItemList.ClearList(),Client.DeleteDoneItemsOfProject(currentProjectId,function(){RefreshCurrentProject();RefreshFilterCounts()}))}
function ShowDoneItems(){$("#DoneItemsShowLink").attr("showAll")=="true"?HideDoneItems():($("#DoneItemsShowLink").html("Hide"),$("#DoneItemsShowLink").attr("showAll","true"),$("#DoneItemsHideLink").hide(),currentSelectedList==SharedTasksList?Server_GetDoneSharedTaskItems(currentProjectId,function(c){DoneItemList.LoadItems(c.Items)}):Client.GetDoneItemsOfProject(currentProjectId,function(c){DoneItemList.LoadItems(c)}))}
function CheckItemListForEmpty(){$(ItemList.list).children().size()==0?$(".NoItems").show():$(".NoItems").hide()}
function UpdateItemsInfo(c){if(currentProjectInfo!=void 0){var e=currentProjectInfo.DoneItemsCount;e<0&&(e=0);$("#DoneItemsCount").html(e);c?(DoneItemList.ClearList(),$("#DoneItemsShowLink").html("See all"),$("#DoneItemsShowLink").attr("showAll",!1),$("#DoneItemsHideLink").hide()):DoneItemList.Count()>0&&$("#DoneItemsShowLink").attr("showAll")!="true"?$("#DoneItemsHideLink").show():$("#DoneItemsHideLink").hide();$("#DoneItemsDeleteLink").toggle(currentProjectId>0)}}
function GetSerializedItemList(c){return c.mainItemList};var serverUrl=document.domain,Client=new TodolyClient,currentProjectId,currentProjectInfo,currentSelectedList,currentSettingsDialog,currentDateString,IconArray=["page2.png","Home.png","other.png","alert.png","ball.png","bug.png","favorite.png","film.png","life.png","mail.png","note.png","television.png","twitter.png","warning.png","cart2.png","inbox3.png","today.png","all.png","trash2.gif","done.png","next.png","folders.png","users.png","user.png"],PriorityColorArray=["#FF3300","#168BB8","#51992D",
"#000000"],NotesWaterMarkClass="InputTextAddItemNotesWatermark",ProjectList,ItemList,FilterList,OtherList,SharedTasksList,preloadedProjectsDataJson,preloadedProjectItemsDataJson,preloadedDefaultProjectId,preloadedUserInfoDataJson,preloadedFiltersDataJson,userData,uiSettings,filtersData,previousHoverElement,ListsArrays=[],myNicEditor,showNotes;
function StartMainApplication(){if(!this.JSON)this.JSON={};ShowHideMainContent(!1);myNicEditor=new nicEditor;InitShowNotes();InitFilters();InitProjects();InitItems();LoadTitleStates();var c=$("#ctl00_MainContent_MainControl_TextBox_preloadedProjectsDataJson").val(),e=$("#ctl00_MainContent_MainControl_TextBox_preloadedProjectItemsDataJson").val(),d=$("#ctl00_MainContent_MainControl_TextBox_preloadedUserInfoDataJson").val(),f=$("#ctl00_MainContent_MainControl_TextBox_preloadedFiltersDataJson").val(),
g=$("#ctl00_MainContent_MainControl_TextBox_preloadedDefaultProjectId").val(),h=$("#ctl00_MainContent_MainControl_TextBox_preloadedUiSettings").val(),c=$.evalJSON(c),e=$.evalJSON(e);userData=$.evalJSON(d);filtersData=$.evalJSON(f);uiSettings=$.evalJSON(h);InitWatermark();SetFontSize(uiSettings.FontSize);LoadFiltersByData(filtersData);LoadSharesByData(filtersData);LoadProjectsByData(c,!0);HighlightProjectById(g);currentSelectedList=g<=0?FilterList:ProjectList;LoadItemsByData(e,g,g<=0);ShowHideMainContent(!0);
$("#NewItemContentInput").autogrow();InitUserPreferences();InitSortMenu();InitAddNewItemCalendar();$("#OpenIdLink1").popupWindow({centerBrowser:1,height:500,width:700});$("#OpenIdLink2").popupWindow({centerBrowser:1,height:500,width:700})}function RefreshFirstDay(){$("#AddItemAdvDate").datepicker("option","firstDay",userData.FirstDayOfWeek)}function ShowHideMainContent(c){c?($("#MainLoadingDiv").hide(),$("#MainTable").show()):($("#MainTable").hide(),$("#MainLoadingDiv").show())}
function InitDraggable(){$(".draga").draggable({revert:!0})}function Log(c){window.console&&window.console.log(c)}
function InitWatermark(){NotesWaterMarkClass=userData.IsProUser?"InputTextAddItemNotesWatermark":"InputTextAddItemNotesWatermarkNoPro";$("#AddItemNotesSpan").addClass(NotesWaterMarkClass);$("#NewItemContentInput").focus(function(){$(this).filter(function(){return $(this).val()==""}).removeClass("InputTextAddItemWatermark").val("")});$("#NewItemContentInput").blur(function(){$(this).filter(function(){return $(this).val()==""}).addClass("InputTextAddItemWatermark")});$("#AddItemAdvDate").focus(function(){$(this).filter(function(){return $(this).val()==
""}).removeClass("InputTextAddItemDueDateWatermark").val("")});$("#AddItemAdvDate").blur(function(){$(this).filter(function(){return $(this).val()==""}).addClass("InputTextAddItemDueDateWatermark")});$("#AddItemNotesSpan").focus(function(){$(this).filter(function(){return isHtmlBoxEmpty($(this))}).removeClass(NotesWaterMarkClass).val("")});$("#AddItemNotesSpan").blur(function(){$(this).filter(function(){return isHtmlBoxEmpty($(this))}).addClass(NotesWaterMarkClass)});myNicEditor.addInstance("AddItemNotesSpan")}
function ShowLogin(c){c?($(".HPloginDiv").show(),$(".HPloginDiv").dropShadow()):($(".HPloginDiv").fadeIn("fast",function(){$(".HPloginDiv").dropShadow()}),$(".HPloginDiv").find("input:first").focus())}function HideLogin(){$(".HPloginDiv").fadeOut();$(".HPloginDiv").removeShadow()}function ShowForgotPassword(c){c?($("#ForgotDiv").show(),$(".HPloginDiv").dropShadow()):($(".HPloginDiv").removeShadow(),$("#ForgotDiv").slideDown("fast",function(){$(".HPloginDiv").dropShadow()}))}
function ShowSignup(c){c?($(".HPsignupDiv").show(),$(".HPsignupDiv").dropShadow()):($(".HPsignupDiv").fadeIn("fast",function(){$(".HPsignupDiv").dropShadow()}),$(".HPsignupDiv").find("input:first").focus());c=getTimeZoneId();c!=void 0&&$(".HPsignupDiv").find(".HPSignupDropDown option[value='"+c+"']").attr("selected","selected")}function HideSignup(){$(".HPsignupDiv").removeShadow();$(".HPsignupDiv").fadeOut()}function ShowAddNewProject(){$("#AddNewProjDiv").slideToggle("slow")}
function ShowAddNewItemAdvPanel(){$(".AddItemAdvPanel").slideToggle("slow",function(){if($("#AddItemMore").attr("src")=="/Images/AddItemBoxMoreNew.png"){$("#AddItemMore").attr("src","/Images/AddItemBoxLessNew.png");var c={AddItemMoreExpanded:!0}}else $("#AddItemMore").attr("src","/Images/AddItemBoxMoreNew.png"),c={},c.AddItemMoreExpanded=!1;Client.UpdateUser(c)})}
function InitUserPreferences(){userData.AddItemMoreExpanded?($("#AddItemMore").attr("src","/Images/AddItemBoxLessNew.png"),$("#AddItemAdvPanel").show()):($("#AddItemMore").attr("src","/Images/AddItemBoxMoreNew.png"),$("#AddItemAdvPanel").hide())}
function InitAddNewItemCalendar(){$("#AddItemAdvDate").datetimepicker({dateFormat:"dd M y",timeFormat:"hh:mm tt",showButtonPanel:!1,minuteGrid:15,firstDay:userData.FirstDayOfWeek,onOpen:function(){$("#AddItemAdvDate").removeClass("InputTextAddItemDueDateWatermark")},onSelect:function(){$("#AddItemAdvDate").removeClass("InputTextAddItemDueDateWatermark")}})}
function formatDueDate(c){return dateVal=Date.today().getFullYear()==c.getFullYear()?c.toString("d MMM, hh:mm tt"):c.toString("d MMM yyyy, hh:mm tt")}
function ParseDate(c){if(!(c==void 0||c.trim()=="")){c=c.toLowerCase();if(c=="today")c=Date.parse("today").toString("M/d/yyyy")+" 10:00";else if(c=="tomorrow")c=Date.parse("tomorrow").toString("M/d/yyyy")+" 10:00";else if(c.indexOf("today")>=0)var e=Date.parse("today").toString("M/d/yyyy"),c=c.replace("today",e);else c.indexOf("tomorrow")>=0&&(e=Date.parse("tomorrow").toString("M/d/yyyy"),c=c.replace("tomorrow",e));c=ParseWeekdays(c);return Date.parse(c)}}
function ParseWeekdays(c){for(var e=0;e<weekdays.length;e++)if(c==weekdays[e]){Date.parse(weekdays[e])<Date.today()&&(c=Date.parse("next "+weekdays[e]).toString("d MMM yyyy"));c+=", 10:00";break}for(e=0;e<weekdays.length;e++)if(c.indexOf(weekdays[e])>=0){Date.parse(weekdays[e])<Date.today()&&(c=c.replace(weekdays[e],Date.parse("next "+weekdays[e]).toString("d MMM yyyy")));break}c.indexOf(" at")>=0&&(c=c.replace(" at"," , "));c.indexOf("@")>=0&&(c=c.replace("@",","));return c}
function RepeatTypeChange(){var c=$("#AddItemAdvPanel");c.find("#RecDivDaily").hide();c.find("#RecDivWeekly").hide();c.find("#RecDivMonthly").hide();c.find("#RecDivYearly").hide();var e=$("#SelectRepeatType").val();e==1?c.find("#RecDivDaily").show():e==2?c.find("#RecDivWeekly").show():e==3?c.find("#RecDivMonthly").show():e==4&&c.find("#RecDivYearly").show()}
function CreateListItem(c){if(c==1)return new CheckListItem;else if(c==2)return new ProjectListItem;else if(c==3)return new DoneListItem;else if(c==4)return new FilterListItem;else if(c==5)return new PlaceholderListItem;else if(c==6)return new PlaceholderListItem({done:!0});else if(c==7)return new DeletedListItem}
function GetRecurrenceFromPanel(c){var e={};e.RepeatType=c.find("#SelectRepeatType").val();e.SelectDays=c.find("#SelectDays").val();e.SelectWeeks=c.find("#SelectWeeks").val();e.Weekday0=c.find("#WeekDay0").attr("checked");e.Weekday1=c.find("#WeekDay1").attr("checked");e.Weekday2=c.find("#WeekDay2").attr("checked");e.Weekday3=c.find("#WeekDay3").attr("checked");e.Weekday4=c.find("#WeekDay4").attr("checked");e.Weekday5=c.find("#WeekDay5").attr("checked");e.Weekday6=c.find("#WeekDay6").attr("checked");
e.SelectMonths=c.find("#SelectMonths").val();e.MonthByMonthDay=c.find("#BYMONTHDAY").attr("checked");e.MonthByDay=c.find("#BYDAY").attr("checked");e.SelectYears=c.find("#SelectYears").val();return e}
function ResetRecurrencePanel(c){c.find("#SelectRepeatType").val(0);c.find("#SelectDays").val(1);c.find("#SelectWeeks").val(1);c.find("#WeekDay0").removeAttr("checked");c.find("#WeekDay1").removeAttr("checked");c.find("#WeekDay2").removeAttr("checked");c.find("#WeekDay3").removeAttr("checked");c.find("#WeekDay4").removeAttr("checked");c.find("#WeekDay5").removeAttr("checked");c.find("#WeekDay6").removeAttr("checked");c.find("#SelectMonths").val(1);c.find("#BYMONTHDAY").attr("checked","checked");c.find("#SelectYears").val(1)}
function AlertInvalidDate(){var c=$("#WrongDateDialog").clone();c.dialog({bgiframe:!0,modal:!0,draggable:!1,resizable:!1,autoOpen:!1,buttons:{Ok:function(){$(this).dialog("close")}}});c.dialog("open")}function IsEmpty(c){return c==null||c.replace(/\s/g,"")==""}function RegisterList(c,e){ListsArrays[c]=e}function GetListObject(c){return ListsArrays[c]}function GetListObjectByChild(c){ulName=$(c).parents("ul:last").attr("id");return GetListObject(ulName)}var settingsDialogInitialized=!1;
function RefreshSettings(){Client.GetSettings(function(c){$("#OpenIdGLinked").toggle(c.IsGoogleLinked);$("#OpenIdGUnlinked").toggle(!c.IsGoogleLinked);$("#OpenIdYLinked").toggle(c.IsYahooLinked);$("#OpenIdYUnlinked").toggle(!c.IsYahooLinked)})}function UnlinkGoogleAccount(){Client.UnlinkGoogle(function(c){c==!0&&(currentSettingsDialog.find("#OpenIdGLinked").hide(),currentSettingsDialog.find("#OpenIdGUnlinked").show())})}
function UnlinkYahooAccount(){Client.UnlinkYahoo(function(c){c==!0&&(currentSettingsDialog.find("#OpenIdYLinked").hide(),currentSettingsDialog.find("#OpenIdYUnlinked").show())})}
function OpenSettingsDialog(c){var e=$("#settingsDialog");currentSettingsDialog=e;settingsDialogInitialized||e.find("#settings_info").tabs();c!=null&&e.find("#settings_info").tabs("select",c);Client.GetSettings(function(c){currentSettingsDialog.data=c;e.find("#DefaultProject").empty();for(var f=0;f<c.ListOfProjects.length;f++)e.find("#DefaultProject").append($("<option></option>").attr("value",c.ListOfProjects[f].Id).text(htmlDecode(c.ListOfProjects[f].Name)));e.find("#DefaultProject option[value='"+
c.SelectedProject+"']").attr("selected","selected");e.find("#DropDownTimezone option[value='"+c.TimeZoneId+"']").attr("selected","selected");e.find("#FullNameInput").val(c.FullName);e.find("#EmailInput").val(c.Email);e.find("#DropDownNewTaskDueDate option[value='"+c.NewTaskDueDate+"']").attr("selected","selected");e.find("#DropDownFirstDayOfWeek option[value='"+c.FirstDayOfWeek+"']").attr("selected","selected");c.UiSettings!=void 0&&(e.find("#DropDownFontSize option[value='"+c.UiSettings.FontSize+
"']").attr("selected","selected"),e.find("#CbShowProjectTag").attr("checked",c.UiSettings.ShowFilterProjectTag),e.find("#CbShowContextRightClick").attr("checked",c.UiSettings.ShowMenuOnRightClick),e.find("#CbEditNotesOnClick").attr("checked",c.UiSettings.EditNotesOnClick));e.find("#ProStarts").text(c.ProStarts);e.find("#ProEnds").text(c.ProEnds);e.find("#BillingCycle").text(c.BillingCycle);e.find("#SubscriptionId").text(c.SubscriptionId);e.find("#ProStatus").text(c.IsProCancelled?"Cancelled":"Active");
e.find("#CancelPro").toggle(!c.IsProCancelled);e.find("#GoProAgain").toggle(c.IsProCancelled);e.find("#settingsProSummary").toggle(c.IsPro);e.find("#settingsNonPro").toggle(!c.IsPro);e.find("#OpenIdGLinked").toggle(c.IsGoogleLinked);e.find("#OpenIdGUnlinked").toggle(!c.IsGoogleLinked);e.find("#OpenIdYLinked").toggle(c.IsYahooLinked);e.find("#OpenIdYUnlinked").toggle(!c.IsYahooLinked);e.find("#TextPwOld").val("");e.find("#TextPwNew").val("");LoadSharedWithMeSettings(c,e);settingsDialogInitialized?
e.dialog("open"):(e.dialog({bgiframe:!0,modal:!0,resizable:!1,height:470,width:530,dialogClass:"alert",buttons:{Ok:function(){c=currentSettingsDialog.data;c.SelectedProject=e.find("#DefaultProject").val();c.TimeZoneId=e.find("#DropDownTimezone").val();c.FullName=e.find("#FullNameInput").val();c.Email=e.find("#EmailInput").val();c.NewTaskDueDate=e.find("#DropDownNewTaskDueDate").val();c.FirstDayOfWeek=e.find("#DropDownFirstDayOfWeek").val();c.ListOfProjects=null;c.OldPassword=e.find("#TextPwOld").val();
c.NewPassword=e.find("#TextPwNew").val();if(c.UiSettings==void 0)c.UiSettings={};c.UiSettings.FontSize=e.find("#DropDownFontSize").val();c.UiSettings.ShowFilterProjectTag=e.find("#CbShowProjectTag").attr("checked")=="checked";c.UiSettings.ShowMenuOnRightClick=e.find("#CbShowContextRightClick").attr("checked")=="checked";c.UiSettings.EditNotesOnClick=e.find("#CbEditNotesOnClick").attr("checked")=="checked";Client.UpdateSettings(c,function(f){if(f=="ok")e.dialog("close");else if(alert(f.ErrorMessage),
f.ErrorCode==608){location.reload(!0);return}uiSettings=c.UiSettings;SetFontSize(uiSettings.FontSize);ReloadThings()});userData.FirstDayOfWeek=c.FirstDayOfWeek;RefreshFirstDay()},Cancel:function(){$(this).dialog("close")}}}),e.find("#ui-tab-dialog-close").append($("a.ui-dialog-titlebar-close")),$(".ui-dialog-titlebar").remove(),settingsDialogInitialized=!0)})}
function LoadSharedWithMeSettings(c,e){$("#SettingsSharedWithMeList").empty();c.ProjectsSharedWithMe!=null&&BindShareNotifSettings(c.ProjectsSharedWithMe,e.find("#SettingsSharedWithMeList"),$("#SetShareLi"))}function SetSettingsShareEnabled(c,e){c.text(e?"Enabled":"Disabled");e?(c.removeClass("SetShareEnabledRed"),c.addClass("SetShareEnabled")):(c.addClass("SetShareEnabledRed"),c.removeClass("SetShareEnabled"))}
function SetSettingsShareShown(c,e){c.text(e?"Shown":"Not Shown");e?(c.removeClass("SetShareShownRed"),c.addClass("SetShareShown")):(c.addClass("SetShareShownRed"),c.removeClass("SetShareShown"))}
function ChangeSettingShareEnabled(c){var e=$(c).attr("projectId");if(currentSettingsDialog.data.ProjectsSharedWithMe!=null)for(var d=0;d<currentSettingsDialog.data.ProjectsSharedWithMe.length;d++)if(currentSettingsDialog.data.ProjectsSharedWithMe[d].Id==e)currentSettingsDialog.data.ProjectsSharedWithMe[d].IsShareApproved=!currentSettingsDialog.data.ProjectsSharedWithMe[d].IsShareApproved,SetSettingsShareEnabled($(c),currentSettingsDialog.data.ProjectsSharedWithMe[d].IsShareApproved)}
function ChangeSettingShareShown(c){var e=$(c).attr("projectId");if(currentSettingsDialog.data.ProjectsSharedWithMe!=null)for(var d=0;d<currentSettingsDialog.data.ProjectsSharedWithMe.length;d++)if(currentSettingsDialog.data.ProjectsSharedWithMe[d].Id==e)currentSettingsDialog.data.ProjectsSharedWithMe[d].ShownInFilters=!currentSettingsDialog.data.ProjectsSharedWithMe[d].ShownInFilters,SetSettingsShareShown($(c),currentSettingsDialog.data.ProjectsSharedWithMe[d].ShownInFilters)}
function InitSortMenu(){SetListSortText();$(".SortMenu").contextMenu({menu:"moreContextMenu",inSpeed:10,outSpeed:20,toLeft:!0},function(c){if(c=="order"&&userData.ListSortType!=0){var e={ListSortType:0};Client.UpdateUser(e,function(){DisplayInfo("Sorted by Order. You can rearrange items by dragging them.");RefreshCurrentProject()});userData.ListSortType=0;SetListSortText()}if(c=="priority"&&userData.ListSortType!=1)e={},e.ListSortType=1,Client.UpdateUser(e,function(){DisplayInfo("Sorted by Priority. You cannot rearrange items, you can only move them to different project");
RefreshCurrentProject()}),userData.ListSortType=1,SetListSortText();if(c=="duedate"&&userData.ListSortType!=2)e={},e.ListSortType=2,Client.UpdateUser(e,function(){DisplayInfo("Sorted by Due Date. You cannot rearrange items, you can only move them to different project");RefreshCurrentProject()}),userData.ListSortType=2,SetListSortText()},function(){},function(){})}
function SetListSortText(){userData.ListSortType==2?$("#SortMenu").text("Due Date"):userData.ListSortType==1?$("#SortMenu").text("Priority"):$("#SortMenu").text("Order")}function ReloadThings(){RefreshCurrentProject();RefreshFilterCounts();RefreshProjects();RefreshShares()}function RefreshProjectSelection(){if(currentProjectId!=void 0){var c=$("div[itemid='"+currentProjectId+"']:first");c.addClass("ProjectSelected")}(c==void 0||c.length==0)&&FilterSelected($("div[itemid='0']:first"))}
function RefreshCurrentProject(){LoadItems(currentProjectId,currentProjectId<=0)}var errorMessageId;function DisplayError(c){HideInfo(!0);$("#ErrorMessageText").text(c);$("#HeaderMessageError").effect("pulsate",{times:1},200);clearTimeout(errorMessageId);errorMessageId=setTimeout("HideError()",1E4)}function HideError(c){clearTimeout(errorMessageId);c?$("#HeaderMessageError").hide():$("#HeaderMessageError").fadeOut()}var infoMessageId;
function DisplayInfo(c){HideError(!0);$("#InfoMessageText").text(c);$("#HeaderMessageInfo").fadeIn("slow");clearTimeout(infoMessageId);infoMessageId=setTimeout("HideInfo()",1E4)}function HideInfo(c){clearTimeout(infoMessageId);c?$("#HeaderMessageInfo").hide():$("#HeaderMessageInfo").fadeOut()}function HideAllMenus(c){$(".EditDueDate").hide();$(".contextMenu").hide();c&&($(".ItemMenu").hide(),$(".ProjItemMenu").hide())}
function PrintMainArea(){var c=$("#MainContentArea").clone(),e=$("#printFooter").clone();c.addClass("printable");c.find(".handle").hide();c.find(".DragHandlerTop").hide();c.append(e);c.printElement({leaveOpen:!0,printMode:"popup",pageTitle:"Todo.ly"})}
function PleaseLogin(){$("#pleaseLoginDialog").clone().dialog({bgiframe:!0,modal:!0,draggable:!1,resizable:!1,width:420,dialogClass:"alert",buttons:{"Go to Login Page":function(){window.location.href="/"},Cancel:function(){$(this).dialog("close")}}})}
function LoadTitleStates(){$.cookie("TitleFiltersCollapsed")=="true"&&HideTitleContent($("#TitleFilters"),$("#FilterListPlaceHolder"));$.cookie("TitleSharedCollapsed")=="true"&&HideTitleContent($("#TitleShared"),$("#SharedListPlaceHolder"));$.cookie("TitleProjectsCollapsed")=="true"&&HideTitleContent($("#TitleProjects"),$("#ProjectListPlaceHolder"))}function HideTitleContent(c,e){c.removeClass("LeftMenuTitleInner");c.addClass("LeftMenuTitleInnerCollapsed");e.hide()}
function ToggleFilters(){ToggleTitle($("#TitleFilters"),$("#FilterListPlaceHolder"),"TitleFiltersCollapsed")}function ToggleShared(){ToggleTitle($("#TitleShared"),$("#SharedListPlaceHolder"),"TitleSharedCollapsed")}function ToggleProjects(){ToggleTitle($("#TitleProjects"),$("#ProjectListPlaceHolder"),"TitleProjectsCollapsed")}
function ToggleTitle(c,e,d){c.hasClass("LeftMenuTitleInner")?(c.removeClass("LeftMenuTitleInner"),c.addClass("LeftMenuTitleInnerCollapsed"),e.slideUp("slow"),$.cookie(d,!0)):(c.removeClass("LeftMenuTitleInnerCollapsed"),c.addClass("LeftMenuTitleInner"),e.slideDown("slow"),$.cookie(d,!1))}
function ClearAllProjectSelection(){$(ProjectList.list).find(".LeftLiDiv").removeClass("ProjectSelected");$(FilterList.list).find(".LeftLiDiv").removeClass("ProjectSelected");$(OtherList.list).find(".LeftLiDiv").removeClass("ProjectSelected")}function SetFontSize(c){(c=="11"||c=="12"||c=="13"||c=="14")&&$("link[id*='StyleTextLink']").attr("href","Style/TextStyle"+c+".css")}function ItemShowTooltop(c,e){$(e).attr("itemId");var d=$("#ItemTooltip").clone();$(c).html("");$(c).append(d)}
function NotesToggle(){$.cookie("ShowNotes",$.cookie("ShowNotes")!="true");InitShowNotes();showNotes?ShowAllNotes():$(".LiNotes").hide()}function InitShowNotes(){showNotes=$.cookie("ShowNotes")=="true";$("#NotesAllText").removeClass("NotesAllTextOn");$("#NotesAllText").removeClass("NotesAllTextOff");showNotes?($("#NotesAllText").text("Shown"),$("#NotesAllText").addClass("NotesAllTextOn")):($("#NotesAllText").text("Hidden"),$("#NotesAllText").addClass("NotesAllTextOff"))}
function ShowAllNotes(){$(".LiNotes").each(function(){var c=$(this).find(".LiNotesSpan").html();c&&!IsEmpty(c)&&$(this).show()})}function ShowNewEntryDatePicker(){$("#AddItemAdvDate").datepicker("show")}function DeleteAccountWithAllData(){confirm("ARE YOU SURE YOU WANT TO DELETE YOUR ACCOUNT? \n\n YOUR ACCOUNT WITH ALL TASKS AND PROJECTS WILL BE PERMANENTLY DELETED.")==!0&&Client.DeleteUser(function(){window.location="/SignOut"})}
var weekdays=[["monday"],["tuesday"],["wednesday"],["thursday"],["friday"],["saturday"],["sunday"]],olsonDb=[["Africa/Bangui","W. Central Africa Standard Time"],["Africa/Cairo","Egypt Standard Time"],["Africa/Casablanca","Morocco Standard Time"],["Africa/Harare","South Africa Standard Time"],["Africa/Johannesburg","South Africa Standard Time"],["Africa/Lagos","W. Central Africa Standard Time"],["Africa/Monrovia","Greenwich Standard Time"],["Africa/Nairobi","E. Africa Standard Time"],["Africa/Windhoek",
"Namibia Standard Time"],["America/Anchorage","Alaskan Standard Time"],["America/Argentina/San_Juan","Argentina Standard Time"],["America/Asuncion","Paraguay Standard Time"],["America/Bahia","Bahia Standard Time"],["America/Bogota","SA Pacific Standard Time"],["America/Buenos_Aires","Argentina Standard Time"],["America/Caracas","Venezuela Standard Time"],["America/Cayenne","SA Eastern Standard Time"],["America/Chicago","Central Standard Time"],["America/Chihuahua","Mountain Standard Time (Mexico)"],
["America/Cuiaba","Central Brazilian Standard Time"],["America/Denver","Mountain Standard Time"],["America/Fortaleza","SA Eastern Standard Time"],["America/Godthab","Greenland Standard Time"],["America/Guatemala","Central America Standard Time"],["America/Halifax","Atlantic Standard Time"],["America/Indianapolis","US Eastern Standard Time"],["America/La_Paz","SA Western Standard Time"],["America/Los_Angeles","Pacific Standard Time"],["America/Mexico_City","Mexico Standard Time"],["America/Montevideo",
"Montevideo Standard Time"],["America/New_York","Eastern Standard Time"],["America/Noronha","UTC-02"],["America/Phoenix","US Mountain Standard Time"],["America/Regina","Canada Central Standard Time"],["America/Santa_Isabel","Pacific Standard Time (Mexico)"],["America/Santiago","Pacific SA Standard Time"],["America/Sao_Paulo","E. South America Standard Time"],["America/St_Johns","Newfoundland Standard Time"],["America/Tijuana","Pacific Standard Time"],["Antarctica/McMurdo","New Zealand Standard Time"],
["Atlantic/South_Georgia","UTC-02"],["Asia/Almaty","Central Asia Standard Time"],["Asia/Amman","Jordan Standard Time"],["Asia/Baghdad","Arabic Standard Time"],["Asia/Baku","Azerbaijan Standard Time"],["Asia/Bangkok","SE Asia Standard Time"],["Asia/Beirut","Middle East Standard Time"],["Asia/Calcutta","India Standard Time"],["Asia/Colombo","Sri Lanka Standard Time"],["Asia/Damascus","Syria Standard Time"],["Asia/Dhaka","Bangladesh Standard Time"],["Asia/Dubai","Arabian Standard Time"],["Asia/Irkutsk",
"North Asia East Standard Time"],["Asia/Jerusalem","Israel Standard Time"],["Asia/Kabul","Afghanistan Standard Time"],["Asia/Kamchatka","Kamchatka Standard Time"],["Asia/Karachi","Pakistan Standard Time"],["Asia/Katmandu","Nepal Standard Time"],["Asia/Kolkata","India Standard Time"],["Asia/Krasnoyarsk","North Asia Standard Time"],["Asia/Kuala_Lumpur","Singapore Standard Time"],["Asia/Kuwait","Arab Standard Time"],["Asia/Magadan","Magadan Standard Time"],["Asia/Muscat","Arabian Standard Time"],["Asia/Novosibirsk",
"N. Central Asia Standard Time"],["Asia/Oral","West Asia Standard Time"],["Asia/Rangoon","Myanmar Standard Time"],["Asia/Riyadh","Arab Standard Time"],["Asia/Seoul","Korea Standard Time"],["Asia/Shanghai","China Standard Time"],["Asia/Singapore","Singapore Standard Time"],["Asia/Taipei","Taipei Standard Time"],["Asia/Tashkent","West Asia Standard Time"],["Asia/Tbilisi","Georgian Standard Time"],["Asia/Tehran","Iran Standard Time"],["Asia/Tokyo","Tokyo Standard Time"],["Asia/Ulaanbaatar","Ulaanbaatar Standard Time"],
["Asia/Vladivostok","Vladivostok Standard Time"],["Asia/Yakutsk","Yakutsk Standard Time"],["Asia/Yekaterinburg","Ekaterinburg Standard Time"],["Asia/Yerevan","Armenian Standard Time"],["Atlantic/Azores","Azores Standard Time"],["Atlantic/Cape_Verde","Cape Verde Standard Time"],["Atlantic/Reykjavik","Greenwich Standard Time"],["Australia/Adelaide","Cen. Australia Standard Time"],["Australia/Brisbane","E. Australia Standard Time"],["Australia/Darwin","AUS Central Standard Time"],["Australia/Hobart",
"Tasmania Standard Time"],["Australia/Perth","W. Australia Standard Time"],["Australia/Sydney","AUS Eastern Standard Time"],["Etc/GMT","UTC"],["Etc/GMT+11","UTC-11"],["Etc/GMT+12","Dateline Standard Time"],["Etc/GMT+2","UTC-02"],["Etc/GMT-12","UTC+12"],["Europe/Amsterdam","W. Europe Standard Time"],["Europe/Athens","GTB Standard Time"],["Europe/Belgrade","Central Europe Standard Time"],["Europe/Berlin","W. Europe Standard Time"],["Europe/Brussels","Romance Standard Time"],["Europe/Budapest","Central Europe Standard Time"],
["Europe/Dublin","GMT Standard Time"],["Europe/Helsinki","FLE Standard Time"],["Europe/Istanbul","GTB Standard Time"],["Europe/Kiev","FLE Standard Time"],["Europe/London","GMT Standard Time"],["Europe/Minsk","E. Europe Standard Time"],["Europe/Moscow","Russian Standard Time"],["Europe/Paris","Romance Standard Time"],["Europe/Sarajevo","Central European Standard Time"],["Europe/Warsaw","Central European Standard Time"],["Indian/Mauritius","Mauritius Standard Time"],["Pacific/Apia","Samoa Standard Time"],
["Pacific/Auckland","New Zealand Standard Time"],["Pacific/Fiji","Fiji Standard Time"],["Pacific/Guadalcanal","Central Pacific Standard Time"],["Pacific/Guam","West Pacific Standard Time"],["Pacific/Honolulu","Hawaiian Standard Time"],["Pacific/Pago_Pago","UTC-11"],["Pacific/Port_Moresby","West Pacific Standard Time"],["Pacific/Tongatapu","Tonga Standard Time"]];function getTimeZoneId(){for(var c=jstz.determine().name(),e=0,d=olsonDb.length;e<d;e++)if(olsonDb[e][0]==c)return olsonDb[e][1]};function PlaceholderListItem(c){if(this.options=c)this.done=c.done;this.OnAddingItem=function(c,d){d.find(".LiDiv").attr("onmouseover","");d.find(".LiDiv").attr("onmouseout","");d.find(".LiDiv").attr("onclick","");d.find(".LiDiv").attr("onContextMenu","");d.find("."+this.SmartList.contentHolder).attr("onclick","");d.find("."+this.SmartList.contentHolder).attr("itemId",c.Id);d.find("."+this.SmartList.contentHolder).html(htmlEncodeWithLinks(c.Content));this.done&&d.find(".handle").hide();c.Content.beginsWith("*",
!0)?this.CheckSpecialKeysInContent(c,d):(d.find(".handle").removeClass("handle").removeClass("DragHandler").addClass("DragHandlerTop"),d.find("#ItemCheckBox").attr("itemId",c.Id),d.find("#ItemCheckBox").attr("disabled",!0),c.Checked&&(d.find("#ItemCheckBox").attr("checked",c.Checked),d.find("."+this.SmartList.contentHolder).addClass("DoneItem")),d.find("."+this.SmartList.contentHolder).addClass("PlaceholderItem"));this.RefreshDueDate(c,d);this.RefreshProjectTag(c,d);this.InitNotes(c,d);this.RefreshNotes(c,
d);this.BindEvents(d)};this.RefreshDueDate=function(c,d){c.DateString&&!IsEmpty(c.DateString)?(d.find(".ItemDueDate:first").css("display","block"),d.find(".ItemDueDateInner:first").html(c.DateString)):d.find(".ItemDueDate:first").hide();d.find(".ItemDueDate:first").removeClass("ItemDueDate_p0").removeClass("ItemDueDate_p1").removeClass("ItemDueDate_p2").addClass("ItemDueDate_p"+c.DateStringPriority);d.find(".ItemDueDateInner:first").removeClass("ItemDueDateInner_pp0").removeClass("ItemDueDateInner_pp1").removeClass("ItemDueDateInner_pp2").addClass("ItemDueDateInner_pp"+
c.DateStringPriority)};this.RefreshProjectTag=function(c,d){var f=c.ProjectId!=void 0&&this.SmartList.isFilterList&&uiSettings.ShowFilterProjectTag,g=d.find("#FilterItemProjectDiv");f?(g.css("display","block"),f=GetProjectData(c.ProjectId),f!=void 0?(g.html(f.Content),g.bind("click",function(){SelectProjectById(c.ProjectId)})):g.hide()):g.css("display","none")};this.CheckSpecialKeysInContent=function(c,d){var f=d.find("#ItemCheckDiv:first"),g=d.find("."+this.SmartList.contentHolder+":first");c.Content.beginsWith("*",
!0)?(f.hide(),g.html(htmlEncodeWithLinks(c.Content.substring(1))),g.hasClass("ItemContentDivBoldDisabled")||g.addClass("ItemContentDivBoldDisabled")):(f.show(),g.removeClass("ItemContentDivBoldDisabled"))};this.BindEvents=function(c){var d=this,f=c.find(".LiDiv:first");f.find("#ItemCheckBox:first").bind("click",function(){d.OnChecked(this)});f.find("#ItemNotesBtn").bind("click",function(){d.NotesIconClicked(f,id)})};this.UpdateItemTypeRecursively=function(c,d){c.ItemType=d;for(var f=0;f<c.Children.length;f++)c.Children[f]=
this.UpdateItemTypeRecursively(c.Children[f],d);return this.SmartList.DataListById[c.Id]=c};this.InitNotes=function(c,d){d.find("#LiNotes:first").addClass("LiNotes2");d.find("#ItemNotesBtn:first").addClass("ItemNotesBtn2");var f=d.find("#LiNotesSpan:first").attr("id","LiNotesSpan"+c.Id);c.Notes&&!IsEmpty(c.Notes)&&(this.SetNotesHtml(f,c),showNotes&&d.find("#LiNotes:first").show())};this.RefreshNotes=function(c,d){this.itemUnderEditing||(this.GetNotesSpan(c.Id),c.Notes&&!IsEmpty(c.Notes)?d.find("#ItemNotesBtn:first").css("display",
"block"):d.find("#ItemNotesBtn:first").hide())};this.NotesIconClicked=function(c){c.find("#LiNotes:first").is(":visible")?c.find("#LiNotes:first").hide():c.find("#LiNotes:first").show()};this.SetNotesHtml=function(c,d){c.html(d.Notes);c.find("a").attr("target","_blank");c.find("a").bind("click",function(c){c.stopPropagation()})};this.GetNotesSpan=function(c){return $("#LiNotesSpan"+c)}};function ProjectListItem(c){this.options=c;this.itemMenu="ProjItemMenu";this.OnItemAdded=function(c){SelectProjectById(c.Id)};this.OnItemUpdated=function(c){$("#ProjEditTextbox").removeAttr("readonly");DisplayProjectTitle(c,c.Content)};this.OnItemRemoved=function(){var c=$(this.SmartList.list).find(".LiDiv:first");c!=void 0&&c.attr("itemId")!=void 0&&(c=c.attr("itemId"),SelectProjectById(c))};this.OnAddingItem=function(c,d){d.find(".ProjItemContent").html(htmlEncode(c.Content));c.IsProjectShared?
c.IsOwnProject?d.find(".ProjItemContent").addClass("SharedProjName"):(d.find(".ProjItemContent").attr("title","Shared By: "+c.ProjectShareOwnerName),d.find(".ProjItemContent").addClass("SharedProjNameRed")):(d.find(".ProjItemContent").removeClass("SharedProjName"),d.find(".ProjItemContent").removeClass("SharedProjNameRed"),d.find(".ProjItemContent").attr("title",""));d.find(".ProjItemContent").attr("itemId",c.Id);d.find(".ListCount").html(c.ItemsCount);d.find(".ListCount").attr("itemId",c.Id);c.ItemsCount==
0&&d.find(".ListCount").hide();this.SetProjectIcon(d,c.Icon);this.BindEvents(d)};this.BindEvents=function(c){var d=this,c=c.find(".LiDiv:first");uiSettings.ShowMenuOnRightClick&&c.bind("contextmenu",function(c){d.OnContextMenu(c,this)});c.bind("mouseover",function(){d.OnMouseOver(this)});c.bind("mouseout",function(){d.OnMouseOut(this)})};this.OnContextMenu=function(c,d){var f=$(d);f.find("."+this.itemMenu).show();f.find("."+this.itemMenu).mousedown();f.find("."+this.itemMenu).mouseup();c.preventDefault();
return!1};this.OnMouseOver=function(c){c=$(c);c.find("."+this.itemMenu).length!=0&&(c.find("."+this.itemMenu).show(),c.find(".ListCount").hide())};this.OnMouseOut=function(c){if(this.SmartList.menuOpenedOnElement==void 0||$(c).attr("itemId")!=$(this.SmartList.menuOpenedOnElement).attr("itemId"))c=$(c),c.find("."+this.itemMenu).hide(),c.find(".ListCount").html()!="0"&&c.find(".ListCount").show()};this.OnMenuClicked=function(c,d){var f=$(d).attr("itemId"),g=this.SmartList.GetLiById(f);if(c=="delete"||
c=="removeShare"){if(confirm(c=="removeShare"?"Do you really want to Remove this Shared Project?\r\n\r\nThis project will be hidden for you, but you can add it back from the Settings Panel":"Do you really want to delete the selected project?"))this.SmartList.RemoveItemFromList(f),Client.DeleteProjectById(f,function(){RefreshFilterCounts();RefreshProjects()})}else if(c.substring(4,0)=="icon"){var h=c.substring(4),j={};j.Icon=h;Client.UpdateProjectById(j,f,function(){});this.SetProjectIcon(g,h)}else c==
"edit"?this.SmartList.EditItemText($(".ProjItemContent[itemId="+f+"]")):c=="share"?OpenShareDialog(f,g):c=="addBelow"?this.SmartList.AddItemBelowAbove(g,!0):c=="addAbove"&&this.SmartList.AddItemBelowAbove(g,!1);this.SmartList.menuOpenedOnElement=void 0;d.hide();this.OnMenuClosed(d)};this.OnMenuClosed=function(c){var d=$(c).attr("itemId"),c=this.SmartList.GetLiDivById(d),d=this.SmartList.DataListById[d];c.find(".ListCount").toggle(d.ItemsCount!=0)};this.SetProjectIcon=function(c,d){c.find(".ListIcon:first").attr("style",
"background: url(Images/icons/"+IconArray[d]+") no-repeat;")}};function InitProjects(){var c=$("#ProjectList").clone().attr("id","mainProjectList");$("#ProjectListPlaceHolder").append(c);ProjectList=new SmartList({list:c,itemLi:"BaseProjectLi",itemLiTemp:$("#ProjectList"),entityType:"project",contentHolder:"ProjItemContent",addItemLi:"AddProjectLi",itemMenu:"ProjItemMenu",itemContextMenu:"projectContextMenu",itemEditDiv:"ProjectEditDiv",acceptItemLi:"acceptBoth",dropableType:"BaseItemLi",noUrlInContent:!0,GetSerializedList:GetSerializedProjectList});RegisterList(ProjectList.list.attr("id"),
ProjectList);var c=$(".IconFrameOuter"),e=$(".IconFrame:first").clone();c.empty();for(var d=0;d<15;d++){var f=e.clone();f.attr("style","background: url(Images/icons/"+IconArray[d]+") no-repeat;");f.attr("iconId",d);c.append(f)}}function RefreshProjects(){LoadProjects(!0)}function LoadProjects(c){Client.GetAllProjects(function(e){LoadProjectsByData(e,c);RefreshProjectSelection()})}function LoadProjectsByData(c,e){ProjectList.LoadItems(c);c.length>0&&e!=!0&&SelectProjectById(c[0].Id)}
function AddNewProject(){var c=$("#NewProjNameInput").val();if(c&&c.replace(/\s/g,"")!=""){$("#NewProjNameInput").attr("readonly",!0);$("#NewProjNameButton").attr("disabled",!0);var e={};e.Content=c;Client.CreateProject(e,function(c){ProjectList.AddNewItem(c);$("#NewProjNameInput").removeAttr("readonly");$("#NewProjNameButton").removeAttr("disabled");$("#NewProjNameInput").val("")})}}
function UpdateProjectItemCount(c,e){var d=$(".ListCount[itemId="+e+"]"),f=Number(d.html());f+=c;d.html(f);f<=0?d.hide():(d.show(),d.parent().find(".ProjItemMenu").hide())}function RefreshProjectCounter(c){var e=$(".ListCount[itemId="+c+"]");Client.GetInfoOfProject(c,function(c){c=Number(c.ItemsCount);e.html(c);c<=0?e.hide():(e.show(),e.parent().find(".ProjItemMenu").hide())})}function SelectProjectById(c){c=ProjectList.GetLiDivById(c);ProjectSelected(c)}
function ProjectSelected(c){var e=$(c).attr("itemId");e!=currentProjectId&&(currentSelectedList=ProjectList,ClearAllProjectSelection(),$(c).addClass("ProjectSelected"),currentProjectId=e,LoadItems(e))}function HighlightProjectById(c){ClearAllProjectSelection();currentProjectId=c;RefreshProjectSelection()}var actualShareDialog;function OpenShareDialog(c,e){Client.GetProjectShareSettings(c,function(c){c==""&&(c={});OpenShareDialogByShareData(c,e)})}
function OpenShareDialogByShareData(c,e){actualShareDialog=$("#shareDialog").clone();actualShareDialog.find("#TextShareEmail").watermark("Email address",{className:"greywatermark"});actualShareDialog.dialog({bgiframe:!0,modal:!0,draggable:!1,closeOnEscape:!1,resizable:!1,width:450,dialogClass:"alert",buttons:{Save:function(){var c=this;Client.SetProjectShareSettings(actualShareDialog.ShareSettingsObject,actualShareDialog.ShareSettingsObject.ProjectId,function(){$(c).dialog("close");DisplayInfo("Project Share settings have been saved.");
RefreshProjectSharedState(e)})},Cancel:function(){$(this).dialog("close")}}});$(window).resize(function(){actualShareDialog.dialog("option","position","center")});actualShareDialog.ShareSettingsObject=c;DisplayShareList();userData.IsProUser||actualShareDialog.parent().find(":button:contains('Save')").attr("disabled",!0).addClass("ui-state-disabled");actualShareDialog.find("#ShareForPro").toggle(!userData.IsProUser);SetShareAutoCompleteText()}
function SetShareAutoCompleteText(){var c=$.cookie("ShareEmailAddressList"),c=c==void 0?[]:c.split(",");actualShareDialog!=void 0&&actualShareDialog.find("#TextShareEmail").autocomplete({source:c,select:function(){setTimeout(ShareTextChange,200)}})}
function AddEmailToShareAutoComplete(c){var e=$.cookie("ShareEmailAddressList"),e=e==void 0?[]:e.split(","),d=!1;if(e!=void 0&&e.length>0)for(var f=0;f<e.length;f++)if(e[f]==c){d=!0;break}d||(e[e.length]=c,$.cookie("ShareEmailAddressList",e));SetShareAutoCompleteText()}
function RefreshProjectSharedState(c,e){var e=actualShareDialog.ShareSettingsObject.ListOfPersons.length,d=actualShareDialog.ShareSettingsObject.ApplyToSubProjects?".ProjItemContent":".ProjItemContent:first";e?c.find(d).addClass("SharedProjName"):c.find(d).removeClass("SharedProjName")}
function AddPersonShare(){var c=actualShareDialog.find("#TextShareEmail").val();if(CheckIfShareEmailExists(c))alert("This person is already added to the list!");else{if(actualShareDialog.ShareSettingsObject.ListOfPersons==void 0)actualShareDialog.ShareSettingsObject.ListOfPersons=[];var e={};e.UserEmail=c;actualShareDialog.ShareSettingsObject.ListOfPersons[actualShareDialog.ShareSettingsObject.ListOfPersons.length]=e;actualShareDialog.find("#TextShareEmail").val("");DisplayShareList();CheckShareAddButton();
actualShareDialog.find("#TextShareEmail").focus();AddEmailToShareAutoComplete(c)}}function CheckIfShareEmailExists(c){var e=actualShareDialog.ShareSettingsObject.ListOfPersons;if(e!=void 0)for(var d=0;d<e.length;d++)if(e[d].UserEmail==c)return!0;return!1}function ShareTextChange(c){var e=CheckShareAddButton();typeof c!="undefined"&&c.keyCode==13&&c.shiftKey!=1&&e&&AddPersonShare()}
function CheckShareAddButton(){var c=$.trim(actualShareDialog.find("#TextShareEmail").val());return isValidEmailAddress(c)?(actualShareDialog.find("#validEmail").css({"background-image":"url('/images/validYes.png')"}),actualShareDialog.find("#validEmail").attr("title","Valid"),actualShareDialog.find("#ButtonAddShare").attr("disabled",!1),!0):(actualShareDialog.find("#validEmail").css({"background-image":"url('/images/validNo.png')"}),actualShareDialog.find("#validEmail").attr("title","Enter a Valid Email Address"),
actualShareDialog.find("#ButtonAddShare").attr("disabled",!0),!1)}
function DisplayShareList(){actualShareDialog.find("#ShareListTable > tbody:last").empty();var c=actualShareDialog.ShareSettingsObject.ListOfPersons;if(c!=void 0)for(var e=0;e<c.length;e++){var d=c[e],f=$("#ShareRow").clone();f.attr("itemId",e);d.UserName!=null?f.find("#SharePerson").text(d.UserName+" ("+d.UserEmail+")"):f.find("#SharePerson").text(d.UserEmail);f.find("#SelectShareRight").val(d.RightId);actualShareDialog.find("#ShareListTable > tbody:last").append(f)}$.cookie("ApplyToSubProjects")=="true"?
actualShareDialog.find("#CbApplyToSubProjects").attr("checked",!0):actualShareDialog.find("#CbApplyToSubProjects").attr("checked",!1);ShareApplySubChange();actualShareDialog.dialog("option","position","center")}function RemovePersonShare(c){c=$(c).closest("tr").attr("itemId");actualShareDialog.ShareSettingsObject.ListOfPersons.splice(c,1);DisplayShareList()}
function ChangePersonShare(c){var e=$(c).closest("tr").attr("itemId");actualShareDialog.ShareSettingsObject.ListOfPersons[e].RightId=$(c).val()}function ShareApplySubChange(){actualShareDialog.ShareSettingsObject.ApplyToSubProjects=actualShareDialog.find("#CbApplyToSubProjects").attr("checked")=="checked";$.cookie("ApplyToSubProjects",actualShareDialog.ShareSettingsObject.ApplyToSubProjects)}function GetSerializedProjectList(c){return c.mainProjectList}
function DisplayProjectTitle(c,e){$("#CurrentProjectTitle").html(htmlEncode(e));c!=null&&c.IsProjectShared&&c.ProjectShareOwnerName!=null?($(".ProjectSharedByTitle").show(),$("#ProjectShareByText").text("Shared By: "+c.ProjectShareOwnerName),$("#CurrentProjectTitle").removeClass("CurrentProjectTitle"),$("#CurrentProjectTitle").addClass("CurrentProjectTitleShared")):($(".ProjectSharedByTitle").hide(),$("#CurrentProjectTitle").addClass("CurrentProjectTitle"),$("#CurrentProjectTitle").removeClass("CurrentProjectTitleShared"))}
function GetProjectData(c){return ProjectList.GetDataById(c)};function SmartList(c){this.options=c;this.list=c.list;this.itemLi=c.itemLi;this.itemLiTemp=c.itemLiTemp;this.entityType=c.entityType;this.contentHolder=c.contentHolder;this.acceptItemLi=c.acceptItemLi;this.noUrlInContent=c.noUrlInContent;this.GetSerializedList=c.GetSerializedList;this.addItemLi=c.addItemLi;this.itemMenu=c.itemMenu;this.itemContextMenu=c.itemContextMenu;this.itemEditDiv=c.itemEditDiv;this.isFilterList=c.isFilterList;this.dropableType=c.dropableType;this.menuToLeft=c.menuToLeft;this.DataListById=
[];this.ItemArray=[];this.LoadItems=function(c){this.ClearList();if(c!=null)for(var d=0;d<c.length;d++)this.AddItemToList(c[d],this.list);this.InitializeItems()};this.ClearList=function(){$(this.list).empty()};this.Count=function(){return this.ItemArray.length};this.AddNewItem=function(c){this.AddItemToList(c,this.list);this.InitializeItems();this.GetItem(c.Id).OnItemAdded&&this.GetItem(c.Id).OnItemAdded(c)};this.AddNewSubItem=function(c,d){var f=c.find(".InputTextEdit:first").val();if(f&&f.replace(/\s/g,
"")!=""){c.find(".InputTextEdit:first").attr("readonly","readonly");var g=this;this.SubmitNewItem(f,function(f){var j=c.closest("ul");g.AddItemToList(f,j,c);g.InitializeItems();g.GetItem(f.Id).OnItemAdded&&g.GetItem(f.Id).OnItemAdded(f);c.remove();g.itemUnderAdding=void 0;g.CheckAndUpdateItemOrder(j);d&&(f=g.GetLiById(f.Id),g.AddItemBelowAbove(f,!0))})}};this.AddOrOverwriteItem=function(c){var d=this.GetLiById(c.Id);d.length==0?this.AddNewItem(c):(this.AddItemToList(c,this.list,d),d.remove())};this.CheckAndUpdateItemOrder=
function(c){for(var d=c.parent().attr("itemId"),f=[],g=0;g<c.children().length;g++){var h=$(c.children()[g]).attr("itemId"),j=this.DataListById[h];if(j.ParentId!=d)d==void 0&&(d=0),this.UpdateParent(j.Id,d,g+1),j.ParentId=d,j.ItemOrder=g+1;if(j.ItemOrder!=g+1){var k={};k.ItemId=j.Id;k.ItemOrder=g+1;f[f.length]=k;j.ItemOrder=g+1}this.DataListById[h]=j}f.length>0&&this.UpdateOrderList(f)};this.UpdateParent=function(c,d,f,g){var h={};h.ParentId=d!=void 0&&d!=""?d:0;h.ItemOrder=f;this.SubmitUpdate(c,
h,g)};this.UpdateCollapsed=function(c,d,f){var g={};g.Collapsed=d;this.SubmitUpdate(c,g,f)};this.UpdateContent=function(c,d,f){var g={};g.Content=d;this.SubmitUpdate(c,g,f)};this.UpdateOrderList=function(c){var d=this;this.entityType=="project"?Client.UpdateProjectOrder(c,function(c){d.DataListById[c.Id]=c}):this.entityType=="item"&&Client.UpdateItemOrder(c,function(c){d.DataListById[c.Id]=c})};this.SubmitNewItem=function(c,d){var f=this;if(this.entityType=="project"){var g={};g.Content=c;Client.CreateProject(g,
function(c){f.DataListById[c.Id]=c;d&&d(c)})}else if(this.entityType=="item")g={},g.Content=c,g.ProjectId=currentProjectId,Client.CreateItem(g,function(c){f.DataListById[c.Id]=c;d&&d(c)})};this.SubmitUpdate=function(c,d,f){var g=this;this.entityType=="project"?Client.UpdateProjectById(d,c,function(c){g.DataListById[c.Id]=c;f&&f(c)}):this.entityType=="item"&&Client.UpdateItemById(d,c,function(c){g.DataListById[c.Id]=c;f&&f(c)})};this.GetItem=function(c){return this.ItemArray[c]};this.ReCheckDueDatePanel=
function(c){var d=this.GetLiById(c),f=this.DataListById[c];this.GetItem(c).RefreshDueDate&&this.GetItem(c).RefreshDueDate(f,d)};this.AddItemToList=function(c,d,f){var g=c.Id;this.DataListById[g]=c;this.ItemArray[g]=CreateListItem(c.ItemType);this.ItemArray[g].SmartList=this;var h=$("#"+this.itemLi).clone();h.attr("itemId",g);h.attr("id","ItemId_"+g);h.find(".LiDiv").attr("itemId",g);h.find(".LiDiv").attr("id","ItemId_"+g);h.find("."+this.itemMenu).attr("itemId",g);h.find(".ItemDueDate").attr("itemId",
g);this.GetItem(g).OnAddingItem&&this.GetItem(g).OnAddingItem(c,h);f!=void 0?$(f).after(h):$(d).append(h);h.find("#Arrow").attr("itemId",g);this.BindEvents(h);if(c.Children!=void 0&&c.Children.length!=0){h.find("#Arrow").css("display","block");d=$(this.itemLiTemp).clone();d.attr("id","");d.addClass("ItemSubList");for(f=0;f<c.Children.length;f++)this.AddItemToList(c.Children[f],d);h.append(d);c.Collapsed&&this.CollapseItem(h.children(".LiDiv").children("#Arrow"),!0)}};this.BindEvents=function(c){var d=
this;c.find(".LiDiv:first");c.find("#Arrow").bind("click",function(){d.CollapseItem(this)})};this.EditItemText=function(c){var d=$(c).attr("itemId");if(this.itemUnderEditingId!=d&&this.lastEditedItemId!=d&&!(this.itemUnderEditingId!=null||this.itemUnderAdding!=null)){this.GetItem(d).OnItemEditing&&this.GetItem(d).OnItemEditing(d);this.itemUnderEditingId=d;var f=this.DataListById[d].Content;$(c).empty();this.PutItemEditBoxTo(c,f,d)}};this.PutItemEditBoxTo=function(c,d,f){$(c).addClass("UnderEditingItem");
var g=$(c).width();g-=parseInt($(c).css("padding-left"),10)+parseInt($(c).css("padding-right"),10);var h=$("#"+this.itemEditDiv).clone(),j=h.find("#ItemEditTextbox"),k=h.find("#ItemEditSubmit"),l=h.find("#ItemEditCancel");j.css("height","15px");$(c).append(h);j.attr("itemId",f);j.css("width",g-52+"px");k.attr("itemId",f);l.attr("itemId",f);j.focus();j.val(d);j.autogrow();return j};this.SaveEditItem=function(c,d,f){if($(c).attr("addNewField")=="true")return this.AddNewSubItem(this.itemUnderAdding,
d),!1;var g=$(c).attr("itemId"),c=$(this.list).find("li[itemId='"+g+"']:first").find(".InputTextEdit:first"),h=c.val();if(h&&h.replace(/\s/g,"")!=""){c.attr("readonly","readonly");var j=this;this.itemUnderEditingId=null;this.UpdateContent(g,h,function(c){if(c==null)j.CancelEditItemById(g);else{var e=c.Id;j.DataListById[e]=c;j.ItemUpdated(c);d&&(c=j.GetLiById(e),j.AddItemBelowAbove(c,!0));f&&f()}})}};this.CancelEditItem=function(c){if($(c).attr("addNewField")=="true")return this.itemUnderAdding.remove(),
this.itemUnderAdding=void 0,!1;this.CancelEditItemById($(c).attr("itemId"))};this.CancelEditItemById=function(c){this.itemUnderEditingId=null;var d=$(this.list).find("li[itemId='"+c+"']:first"),f=this.DataListById[c],d=d.find("."+this.contentHolder+":first");this.noUrlInContent?d.html(htmlEncode(f.Content)):d.html(htmlEncodeWithLinks(f.Content));d.removeClass("UnderEditingItem");this.GetItem(c).OnItemEdited&&this.GetItem(c).OnItemEdited(c);this.lastEditedItemId=c;var g=this;setTimeout(function(){g.lastEditedItemId=
null},100)};this.ItemUpdated=function(c){this.CancelEditItemById(c.Id);this.GetItem(c.Id).OnItemUpdated&&this.GetItem(c.Id).OnItemUpdated(c)};this.RemoveItemFromList=function(c,d){this.CancelEditing();var f=$(this.list).find("li[itemId='"+c+"']"),g=this;f.fadeOut(500,function(){f.remove();g.GetItem(c).OnItemRemoved&&g.GetItem(c).OnItemRemoved(c);d&&d();g.CheckArrows();g.DataListById[c]=null})};this.AddMenuToItems=function(){var c=this;$("."+this.itemMenu).contextMenu({menu:this.itemContextMenu,inSpeed:10,
outSpeed:20,toLeft:this.menuToLeft},function(d,f,g){var h=$(f).attr("itemId");c.GetItem(h).OnMenuClicked&&c.GetItem(h).OnMenuClicked(d,f,g)},function(d,f){c.menuOpenedOnElement=d;var g=$(d).attr("itemId"),g=c.DataListById[g];f.find("#ProjShareMenuLi").toggle(g.IsOwnProject);f.find("#ProjShareMenuDel").html(g.IsOwnProject?"Delete":"Remove Share");f.find("#ProjShareMenuDel").attr("href",g.IsOwnProject?"#delete":"#removeShare");g.Notes&&!IsEmpty(g.Notes)?f.find("#removeNotes").removeClass("DisabledMenuItem"):
f.find("#removeNotes").addClass("DisabledMenuItem")},function(d,f){var g=$(d).attr("itemId");c.menuOpenedOnElement=void 0;d.hide();c.GetItem(g).OnMenuClosed&&c.GetItem(g).OnMenuClosed(d,f)})};this.AddItemBelowAbove=function(c,d){this.CancelEditing();$(c).closest("ul");var f=$("#"+this.addItemLi).clone();d?c.after(f):c.before(f);f.find(".LiDiv");this.PutItemEditBoxTo(f.find(".LiDiv"));f.attr("addNewField","true");f.find(".InputTextEdit:first").attr("addNewField","true");f.find("#ItemEditSubmit:first").attr("addNewField",
"true");f.find("#ItemEditCancel:first").attr("addNewField","true");this.itemUnderAdding=f};this.ItemEditKeyDown=function(c,d){if(typeof c!="undefined"&&c.keyCode==13&&c.shiftKey!=1){if($(d).attr("addNewField")=="true")return this.AddNewSubItem(this.itemUnderAdding,c.ctrlKey==1),!1;c.returnValue=!1;c.cancel=!0;this.SaveEditItem(d,c.ctrlKey==1);return!1}else if(typeof c!="undefined"&&c.keyCode==27){if($(d).attr("addNewField")=="true")return this.itemUnderAdding.remove(),this.itemUnderAdding=void 0,
!1;c.returnValue=!1;c.cancel=!0;this.CancelEditItem(d);return!1}};this.ItemLostFocus=function(c){var d=this;setTimeout(function(){d.ItemLostFocusPrivate($(c).attr("itemId"))},200)};this.ItemLostFocusPrivate=function(c){if(this.itemUnderEditingId!=null&&c==this.itemUnderEditingId){c=$(this.list).find("li[itemId='"+this.itemUnderEditingId+"']:first").find(".InputTextEdit:first");if($(c).attr("addNewField")=="true")return this.itemUnderAdding.remove(),this.itemUnderAdding=void 0,!1;this.SaveEditItem(c);
return!1}else this.itemUnderAdding!=null&&this.SaveEditItem(this.itemUnderAdding)};this.InitializeItems=function(){this.AddMenuToItems();this.InitializeItemDragAndDrop()};this.InitializeItemDragAndDrop=function(){var c=this,d=!this.isFilterList&&(userData.ListSortType==0||this.entityType=="project");$(this.list).NestedSortable({accept:this.acceptItemLi,opacity:0.6,listType:this.itemLi,allowReorder:d,dropableType:this.dropableType,helperclass:"ItemDragPlaceholder",handle:".handle",nestingPxSpace:20,
noNestingClass:this.addItemLi,onChange:function(d){c.GetSerializedList&&(d=c.GetSerializedList(d[0].o),c.GetChangedItem(d));c.CheckArrows()},onStop:function(){if(previousHoverElement!=void 0){var f=$(this).attr("itemId"),g=$(previousHoverElement).attr("itemId");if(currentProjectId==g)previousHoverElement.removeClass("ProjectSelectedMoveItem");else{var h=c.DataListById[f];c.GetItem(f).OnItemMoved&&c.GetItem(f).OnItemMoved(f,currentProjectId,g,this);previousHoverElement.effect("pulsate",{times:1},200,
function(){previousHoverElement.removeClass("ProjectSelectedMoveItem")});var j={};g==-3?Client.DeleteItemById(f,function(){RefreshProjectCounter(currentProjectId);RefreshFilterCounts()}):currentProjectId==-3?(j.ProjectId=g,Client.UnDeleteItemById(j,f,function(){RefreshProjectCounter(g);RefreshFilterCounts()})):(j.ProjectId=g,Client.UpdateItemById(j,f,function(){RefreshProjectCounter(currentProjectId);RefreshProjectCounter(g);currentProjectId!=h.ProjectId&&g!=h.ProjectId&&h.ProjectId!=void 0&&RefreshProjectCounter(h.ProjectId);
currentProjectId==-3&&RefreshFilterCounts()}));f=ProjectList.DataListById[g];f=f!=void 0?f.Content:"";g==-3?DisplayInfo("Item has been moved to Recycle Bin"):DisplayInfo("Item has been moved to project: "+f)}}else d||(c.isFilterList?DisplayInfo("You can't rearrange items in a Filter list. You can only move them to projects."):DisplayInfo("You can only rearrange items when the list is Sorted By: Order."))}})};this.GetChangedItem=function(c,d){if(c!=void 0){for(var f=[],g=0;g<c.length;g++){var h=c[g].id.substring(7),
j=g+1,k=this.DataListById[h];if(k!=void 0){if(k.ParentId!=d)this.UpdateParent(h,d,j),k.ParentId=d,k.ItemOrder=j,this.DataListById[h]=k,this.ReCheckDueDatePanel(h);if(k.ItemOrder!=j){var l={};l.ItemId=h;l.ItemOrder=j;f[f.length]=l;k.ItemOrder=j;this.DataListById[h]=k;this.ReCheckDueDatePanel(h)}}this.GetChangedItem(c[g].children,h)}f.length>0&&this.UpdateOrderList(f)}};this.CheckArrows=function(){for(var c=$(this.list).find("."+this.itemLi),d=0;d<c.length;d++){var f=$(c[d]),g=f.children(".LiDiv").children("#Arrow"),
f=f.children("ul");f!=void 0&&f.children().size()>0?(g.is(":hidden")&&g.show(),f.is(":visible")&&g.hasClass("ArrowCollapsed")?(g.removeClass("ArrowCollapsed"),g.addClass("ArrowExpanded")):f.is(":hidden")&&g.hasClass("ArrowExpanded")&&(g.removeClass("ArrowExpanded"),g.addClass("ArrowCollapsed"))):g.is(":visible")&&g.hide()}};this.CollapseItem=function(c,d){var f=$(c).attr("itemId"),g=$(c).closest("li").children("ul:first");g.is(":visible")||d?(g.hide(),$(c).removeClass("ArrowExpanded"),$(c).addClass("ArrowCollapsed"),
d==void 0&&this.UpdateCollapsed(f,!0),this.UpdateDataObject(f,"Collapsed",!0)):(g.show(),$(c).removeClass("ArrowCollapsed"),$(c).addClass("ArrowExpanded"),d==void 0&&this.UpdateCollapsed(f,!1),this.UpdateDataObject(f,"Collapsed",!1))};this.CancelEditing=function(){if(this.itemUnderAdding!=void 0)this.itemUnderAdding.remove(),this.itemUnderAdding=void 0;this.itemUnderEditingId!=null&&this.CancelEditItemById(this.itemUnderEditingId)};this.GetLiDivById=function(c){return $(this.list).find(".LiDiv[itemId='"+
c+"']")};this.GetLiById=function(c){return $(this.list).find("."+this.itemLi+"[itemId='"+c+"']")};this.UpdateDataObject=function(c,d,f){var g=this.DataListById[c];if(d=="Collapsed")g.Collapsed=f;this.DataListById[c]=g};this.GetDataById=function(c){return this.DataListById[c]}};$.extend({URLEncode:function(c){for(var e="",d=0,c=c.toString(),f=/(^[a-zA-Z0-9_.]*)/;d<c.length;){var g=f.exec(c.substr(d));g!=null&&g.length>1&&g[1]!=""?(e+=g[1],d+=g[1].length):(c[d]==" "?e+="+":(g=c.charCodeAt(d).toString(16),e+="%"+(g.length<2?"0":"")+g.toUpperCase()),d++)}return e},URLDecode:function(c){for(var e,d=/(%[^%]{2})/;(m=d.exec(c))!=null&&m.length>1&&m[1]!="";)b=parseInt(m[1].substr(1),16),e=String.fromCharCode(b),c=c.replace(m[1],e);return c}});
var unreserved="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_.~",reserved="!*'();:@&=+$,/?%#[]",allowed=unreserved+reserved,hexchars="0123456789ABCDEFabcdef";function gethex(c){return"%"+hexchars.charAt(c>>4)+hexchars.charAt(c&15)}
function encodeUF8(c){for(var e="",d=0;d<c.length;d++){var f=c.charAt(d);unreserved.indexOf(f)!=-1?e+=f:(f=c.charCodeAt(d),f<128&&(e+=gethex(f)),f>127&&f<2048&&(e+=gethex(f>>6|192),e+=gethex(f&63|128)),f>2047&&f<65536&&(e+=gethex(f>>12|224),e+=gethex(f>>6&63|128),e+=gethex(f&63|128)),f>65535&&(e+=gethex(f>>18|240),e+=gethex(f>>12&63|128),e+=gethex(f>>6&63|128),e+=gethex(f&63|128)))}return e}
function getdec(c){if(c.length==3&&c.charAt(0)=="%"&&hexchars.indexOf(c.charAt(1))!=-1&&hexchars.indexOf(c.charAt(2))!=-1)return parseInt(c.substr(1,2),16);return 256}
function decodeUTF8(c){for(var e="",d="",f="",g,h,j,k=0,l=0;l<c.length;)g=c.charAt(l),g=="%"?getdec(c.substr(l,3))<255?(g=getdec(c.substr(l,3)),h=getdec(c.substr(l+3,3)),j=getdec(c.substr(l+6,3)),k=getdec(c.substr(l+9,3)),g<128&&(e+=String.fromCharCode(g),l+=3),g>127&&g<192&&(e+=c.substr(l,3),f=f+c.substr(l,3)+" ",l+=3),g>191&&g<224&&(h>127&&h<192?e+=String.fromCharCode((g&31)<<6|h&63):(e+=c.substr(l,6),f=f+c.substr(l,6)+" "),l+=6),g>223&&g<240&&(h>127&&h<192?j>127&&j<192?e+=String.fromCharCode((g&
15)<<12|(h&63)<<6|j&63):(e+=c.substr(l,9),f=f+c.substr(l,9)+" "):(e+=c.substr(l,9),f=f+c.substr(l,9)+" "),l+=9),g>239&&(h>127&&h<192?j>127&&j<192?k>127&&k<192?e+=String.fromCharCode((g&7)<<18|(h&63)<<12|(j&63)<<6|k&63):(e+=c.substr(l,12),f=f+c.substr(l,12)+" "):(e+=c.substr(l,12),f=f+c.substr(l,12)+" "):(e+=c.substr(l,12),f=f+c.substr(l,12)+" "),l+=12)):(e+=c.substr(l,3),f=f+c.substr(l,3)+" ",l+=3):(allowed.indexOf(g)==-1&&(d=d+g+" "),e+=g,l++);c="";d!=""&&(c=c+"Characters not allowed in a URL:\n"+
d+"\n\n");f!=""&&(c=c+"Illegal percent-encoding (for UTF-8):\n"+f+"\n\n");c!=""&&alert("Warning: Illegal characters/strings in encoded text!\n\n"+c);return e}String.prototype.beginsWith=function(c,e){if(e!=!1)return c.toLowerCase()==this.substring(0,c.length).toLowerCase()};String.prototype.endsWith=function(c,e){if(e==!1)return c==this.substring(this.length-c.length)};function GetDay(c){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][c]}
function GetMonth(c){return["January","February","March","April","May","June","July","August","September","October","November","December"][c]}function GetFullDateString(){var c=new Date,e=c.getYear();e<1E3&&(e+=1900);var d=GetDay(c.getDay())+", ";d+=GetMonth(c.getMonth())+" "+c.getDate();d+=", "+e;return d}function GetCurrentTime(){var c=new Date,e=c.getHours(),d=c.getMinutes();c.getSeconds();var c=" AM",f="";e>=12&&(e-=12,c=" PM");e==0&&(e=12);return e+":"+(d<10?"0":"")+d+c}
function ShowDateTime(){var c=GetFullDateString();$("#DateDiv").html(c+" | "+GetCurrentTime());currentDateString=c}function htmlEncode(c){return $("<div/>").text(c).html()}function htmlEncodeWithLinks(c){c=$("<div/>").text(c).html();return ReplaceURLWithHTMLLinks(c)}function htmlDecode(c){return $("<div/>").html(c).text()}
function isValidEmailAddress(c){return RegExp(/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i).test(c)}function isHtmlBoxEmpty(c){c=c.html();c=$.trim(c);if(c=="<br>"||c=="<div><br></div>")c="";return c==""}
function ReplaceURLWithHTMLLinks(c){var c=c.replace(/(\b(https?|ftp|file|notes|ftps):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig,"<a href='$1' target='_blank' class='itemTextLink'>$1</a>"),e=$("<div/>");e.html(c);e.find("a").each(function(){if(this.href.length>37)this.innerText=this.href.substr(0,37)+"..."});return c=e.html()}
jQuery.extend({get_:function(c,e,d,f){return _ajax_request(c,e,d,f,"GET")},put_:function(c,e,d,f){return _ajax_request(c,e,d,f,"PUT")},post_:function(c,e,d,f){return _ajax_request(c,e,d,f,"POST")},delete_:function(c,e,d,f){return _ajax_request(c,e,d,f,"DELETE")}});function _ajax_request(c,e,d,f,g){jQuery.isFunction(e)&&(d=e,e={});return jQuery.ajax({type:g,url:c,data:e,success:d})}function CancelEventBubble(c){c.returnValue=!1;c.cancel=!0;c.cancelBubble=!0;c.stopPropagation()}
if(typeof String.prototype.trim!=="function")String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};function TodolyClient(){this.basePrefix="https:"==document.location.protocol?"https://"+serverUrl:"http://"+serverUrl;this.baseUrl="/API/";this.baseExtension=".json";this.GetUser=function(c){this.GET(baseUserUrl,c)};this.UpdateUser=function(c,e){this.PUT(this.GetUrlWithId("User",0),c,e)};this.DeleteUser=function(c){this.DELETE(this.GetUrlWithId("User",0),null,c)};this.GetAllProjects=function(c){this.GET(this.baseProjectUrl,c)};this.CreateProject=function(c,e){this.POST(this.baseProjectUrl,c,e)};this.GetProjectById=
function(c,e){this.GET(this.GetUrlWithId("Projects",c),e)};this.UpdateProjectById=function(c,e,d){this.PUT(this.GetUrlWithId("Projects",e),c,d)};this.DeleteProjectById=function(c,e){this.DELETE(this.GetUrlWithId("Projects",c),null,e)};this.GetItemsOfProject=function(c,e){this.GET(this.GetUrlWithIdAdv("Projects",c,"Items"),e)};this.GetItemsOfProjectWithInfo=function(c,e){this.GET(this.GetUrlWithIdAdv("Projects",c,"ItemsWithInfo"),e)};this.GetInfoOfProject=function(c,e){this.GET(this.GetUrlWithIdAdv("Projects",
c,"Info"),e)};this.GetDoneItemsOfProject=function(c,e){this.GET(this.GetUrlWithIdAdv("Projects",c,"DoneItems"),e)};this.DeleteDoneItemsOfProject=function(c,e){this.DELETE(this.GetUrlWithIdAdv("Projects",c,"DoneItems"),null,e)};this.UpdateProjectOrder=function(c,e){this.PUT(this.GetUrlWithIdAdv("Projects",0,"BulkOrder"),c,e)};this.GetProjectShareSettings=function(c,e){this.GET(this.GetUrlWithIdAdv("Projects",c,"ShareSettings"),e)};this.SetProjectShareSettings=function(c,e,d){this.PUT(this.GetUrlWithIdAdv("Projects",
e,"ShareSettings"),c,d)};this.GetAllFilters=function(c){this.GET(this.baseFilterUrl,c)};this.GetFilterById=function(c,e){this.GET(this.GetUrlWithId("Filters",c),e)};this.GetItemsOfFilter=function(c,e){this.GET(this.GetUrlWithIdAdv("Filters",c,"Items"),e)};this.GetDoneItemsOfFilter=function(c,e){this.GET(this.GetUrlWithIdAdv("Filters",c,"DoneItems"),e)};this.DeleteRecycleBinItems=function(c){this.DELETE(this.GetUrlWithIdAdv("Filters",-4,"Items"),null,c)};this.GetAllItems=function(c){this.GET(this.baseItemUrl,
c)};this.CreateItem=function(c,e){this.POST(this.baseItemUrl,c,e)};this.GetItemById=function(c,e){this.GET(this.GetUrlWithId("Items",c),e)};this.UpdateItemById=function(c,e,d){this.PUT(this.GetUrlWithId("Items",e),c,d)};this.DeleteItemById=function(c,e){this.DELETE(this.GetUrlWithId("Items",c),null,e)};this.UnDeleteItemById=function(c,e,d){this.PUT(this.GetUrlWithIdAdv("Items",e,"Undelete"),c,d)};this.GetRootItemById=function(c,e){this.GET(this.GetUrlWithIdAdv("Items",c,"RootItem"),e)};this.GetDoneRootItemById=
function(c,e){this.GET(this.GetUrlWithIdAdv("Items",c,"DoneRootItem"),e)};this.UpdateItemOrder=function(c,e){this.PUT(this.GetUrlWithIdAdv("Items",0,"BulkOrder"),c,e)};this.PostponeItem=function(c,e,d){this.PUT(this.GetUrlWithIdAdv("Items",e,"Postpone"),c,d)};this.GetIconById=function(c,e){this.GET(this.GetUrlWithId("icons",c),e)};this.GetSettings=function(c){this.GET(this.GetUrl("Settings"),c)};this.UpdateSettings=function(c,e){this.PUT(this.GetUrl("Settings"),c,e)};this.UnlinkGoogle=function(c){this.GET(this.GetUrlWithIdAdv("Settings",
0,"UnlinkGoogle"),c)};this.UnlinkYahoo=function(c){this.GET(this.GetUrlWithIdAdv("Settings",0,"UnlinkYahoo"),c)};this.GetPendingShares=function(c){this.GET(this.GetUrl("PendingShares"),c)};this.ApproveAllPendingShares=function(c){this.GET(this.GetUrlWithIdAdv("PendingShares",0,"ApproveAll"),c)};this.DeclineAllPendingShares=function(c){this.GET(this.GetUrlWithIdAdv("PendingShares",0,"DeclineAll"),c)};this.GET=function(c,e){RequestStarted();_ajax_request(c,function(c){e&&e(c);RequestEnded()},"json",
"GET")};this.POST=function(c,e,d){RequestStarted();e=JSON.stringify(e);_ajax_request(c,e,function(c){d&&d(c);RequestEnded()},"json","POST")};this.PUT=function(c,e,d){RequestStarted();e=JSON.stringify(e);_ajax_request(c,e,function(c){d&&d(c);RequestEnded()},"json","PUT")};this.DELETE=function(c,e,d){RequestStarted();e=JSON.stringify(e);_ajax_request(c,e,function(c){d&&d(c);RequestEnded()},"json","DELETE")};this.GetUrl=function(c){return this.basePrefix+this.baseUrl+c+this.baseExtension};this.GetUrlWithId=
function(c,e){return this.basePrefix+this.baseUrl+c+"/"+e+this.baseExtension};this.GetUrlWithIdAdv=function(c,e,d){return this.basePrefix+this.baseUrl+c+"/"+e+"/"+d+this.baseExtension};this.baseUserUrl=this.GetUrl("User");this.baseProjectUrl=this.GetUrl("Projects");this.baseFilterUrl=this.GetUrl("Filters");this.baseItemUrl=this.GetUrl("Items")}var numberOfCurrentRequests=0;function RequestStarted(){numberOfCurrentRequests++;$("#LoaderImg").show()}
function RequestEnded(){numberOfCurrentRequests--;numberOfCurrentRequests<=0&&$("#LoaderImg").hide()};jQuery.iDrag={helper:null,dragged:null,iDragEmpty:function(c){for(jQuery(">*",c).each(function(){this.parentNode&&this.parentNode.removeChild(this)});c.firstChild;)c.removeChild(c.firstChild)},destroy:function(){return this.each(function(){if(this.isDraggable)this.dragCfg.dhe.unbind("mousedown",jQuery.iDrag.draginit),this.dragCfg=null,this.isDraggable=!1,jQuery.browser.msie?this.unselectable="off":(this.style.MozUserSelect="",this.style.KhtmlUserSelect="",this.style.userSelect="")})},draginit:function(c){if(jQuery.iDrag.dragged!=
null)return jQuery.iDrag.dragstop(c),!1;var e=this.dragElem;jQuery(document).bind("mousemove",jQuery.iDrag.dragmove).bind("mouseup",jQuery.iDrag.dragstop);e.dragCfg.pointer=jQuery.iUtil.getPointer(c);e.dragCfg.currentPointer=e.dragCfg.pointer;e.dragCfg.init=!1;e.dragCfg.fromHandler=this!=this.dragElem;jQuery.iDrag.dragged=e;e.dragCfg.si&&this!=this.dragElem&&(parentPos=jQuery.iUtil.getPosition(e.parentNode),sliderSize=jQuery.iUtil.getSize(e),sliderPos={x:parseInt(jQuery.css(e,"left"))||0,y:parseInt(jQuery.css(e,
"top"))||0},dx=e.dragCfg.currentPointer.x-parentPos.x-sliderSize.wb/2-sliderPos.x,dy=e.dragCfg.currentPointer.y-parentPos.y-sliderSize.hb/2-sliderPos.y,jQuery.iSlider.dragmoveBy(e,[dx,dy]));return jQuery.selectKeyHelper||!1},dragstart:function(){var c=jQuery.iDrag.dragged;c.dragCfg.init=!0;var e=c.style;c.dragCfg.oD=jQuery.css(c,"display");c.dragCfg.oP=jQuery.css(c,"position");if(!c.dragCfg.initialPosition)c.dragCfg.initialPosition=c.dragCfg.oP;c.dragCfg.oR={x:parseInt(jQuery.css(c,"left"))||0,y:parseInt(jQuery.css(c,
"top"))||0};c.dragCfg.diffX=0;c.dragCfg.diffY=0;if(jQuery.browser.msie){var d=jQuery.iUtil.getBorder(c,!0);c.dragCfg.diffX=d.l||0;c.dragCfg.diffY=d.t||0}c.dragCfg.oC=jQuery.extend(jQuery.iUtil.getPosition(c),jQuery.iUtil.getSize(c));if(c.dragCfg.oP!="relative"&&c.dragCfg.oP!="absolute")e.position="relative";jQuery.iDrag.iDragEmpty(jQuery.iDrag.helper);d=c.cloneNode(!0);jQuery(d).css({display:"block",left:"0px",top:"0px"});d.style.marginTop="0";d.style.marginRight="0";d.style.marginBottom="0";d.style.marginLeft=
"0";jQuery.iDrag.helper.append(d);var f=jQuery.iDrag.helper.get(0).style;c.dragCfg.autoSize?(f.width="auto",f.height="auto"):(f.height=c.dragCfg.oC.hb+"px",f.width=c.dragCfg.oC.wb+"px");f.display="block";f.marginTop="0px";f.marginRight="0px";f.marginBottom="0px";f.marginLeft="0px";jQuery.extend(c.dragCfg.oC,jQuery.iUtil.getSize(d));if(c.dragCfg.cursorAt){if(c.dragCfg.cursorAt.left)c.dragCfg.oR.x+=c.dragCfg.pointer.x-c.dragCfg.oC.x-c.dragCfg.cursorAt.left,c.dragCfg.oC.x=c.dragCfg.pointer.x-c.dragCfg.cursorAt.left;
if(c.dragCfg.cursorAt.top)c.dragCfg.oR.y+=c.dragCfg.pointer.y-c.dragCfg.oC.y-c.dragCfg.cursorAt.top,c.dragCfg.oC.y=c.dragCfg.pointer.y-c.dragCfg.cursorAt.top;if(c.dragCfg.cursorAt.right)c.dragCfg.oR.x+=c.dragCfg.pointer.x-c.dragCfg.oC.x-c.dragCfg.oC.hb+c.dragCfg.cursorAt.right,c.dragCfg.oC.x=c.dragCfg.pointer.x-c.dragCfg.oC.wb+c.dragCfg.cursorAt.right;if(c.dragCfg.cursorAt.bottom)c.dragCfg.oR.y+=c.dragCfg.pointer.y-c.dragCfg.oC.y-c.dragCfg.oC.hb+c.dragCfg.cursorAt.bottom,c.dragCfg.oC.y=c.dragCfg.pointer.y-
c.dragCfg.oC.hb+c.dragCfg.cursorAt.bottom}c.dragCfg.nx=c.dragCfg.oR.x;c.dragCfg.ny=c.dragCfg.oR.y;if(c.dragCfg.insideParent||c.dragCfg.containment=="parent")parentBorders=jQuery.iUtil.getBorder(c.parentNode,!0),c.dragCfg.oC.x=c.offsetLeft+(jQuery.browser.msie?0:jQuery.browser.opera?-parentBorders.l:parentBorders.l),c.dragCfg.oC.y=c.offsetTop+(jQuery.browser.msie?0:jQuery.browser.opera?-parentBorders.t:parentBorders.t),jQuery(c.parentNode).append(jQuery.iDrag.helper.get(0));if(c.dragCfg.containment)jQuery.iDrag.getContainment(c),
c.dragCfg.onDragModifier.containment=jQuery.iDrag.fitToContainer;c.dragCfg.si&&jQuery.iSlider.modifyContainer(c);f.left=c.dragCfg.oC.x-c.dragCfg.diffX+"px";f.top=c.dragCfg.oC.y-c.dragCfg.diffY+"px";f.width=c.dragCfg.oC.wb+"px";f.height=c.dragCfg.oC.hb+"px";jQuery.iDrag.dragged.dragCfg.prot=!1;if(c.dragCfg.gx)c.dragCfg.onDragModifier.grid=jQuery.iDrag.snapToGrid;c.dragCfg.zIndex!=!1&&jQuery.iDrag.helper.css("zIndex",c.dragCfg.zIndex);c.dragCfg.opacity&&(jQuery.iDrag.helper.css("opacity",c.dragCfg.opacity),
window.ActiveXObject&&jQuery.iDrag.helper.css("filter","alpha(opacity="+c.dragCfg.opacity*100+")"));if(c.dragCfg.frameClass)jQuery.iDrag.helper.addClass(c.dragCfg.frameClass),jQuery.iDrag.helper.get(0).firstChild.style.display="none";c.dragCfg.onStart&&c.dragCfg.onStart.apply(c,[d,c.dragCfg.oR.x,c.dragCfg.oR.y]);jQuery.iDrop&&jQuery.iDrop.count>0&&jQuery.iDrop.highlight(c);if(c.dragCfg.ghosting==!1)e.display="none";return!1},getContainment:function(c){if(c.dragCfg.containment.constructor==String)if(c.dragCfg.containment==
"parent"){c.dragCfg.cont=jQuery.extend({x:0,y:0},jQuery.iUtil.getSize(c.parentNode));var e=jQuery.iUtil.getBorder(c.parentNode,!0);c.dragCfg.cont.w=c.dragCfg.cont.wb-e.l-e.r;c.dragCfg.cont.h=c.dragCfg.cont.hb-e.t-e.b}else{if(c.dragCfg.containment=="document")e=jQuery.iUtil.getClient(),c.dragCfg.cont={x:0,y:0,w:e.w,h:e.h}}else if(c.dragCfg.containment.constructor==Array)c.dragCfg.cont={x:parseInt(c.dragCfg.containment[0])||0,y:parseInt(c.dragCfg.containment[1])||0,w:parseInt(c.dragCfg.containment[2])||
0,h:parseInt(c.dragCfg.containment[3])||0};c.dragCfg.cont.dx=c.dragCfg.cont.x-c.dragCfg.oC.x;c.dragCfg.cont.dy=c.dragCfg.cont.y-c.dragCfg.oC.y},hidehelper:function(c){(c.dragCfg.insideParent||c.dragCfg.containment=="parent")&&jQuery("body",document).append(jQuery.iDrag.helper.get(0));jQuery.iDrag.iDragEmpty(jQuery.iDrag.helper);jQuery.iDrag.helper.hide().css("opacity",1);window.ActiveXObject&&jQuery.iDrag.helper.css("filter","alpha(opacity=100)")},dragstop:function(){jQuery(document).unbind("mousemove",
jQuery.iDrag.dragmove).unbind("mouseup",jQuery.iDrag.dragstop);if(jQuery.iDrag.dragged!=null){var c=jQuery.iDrag.dragged;jQuery.iDrag.dragged=null;if(c.dragCfg.init==!1)return!1;c.dragCfg.so==!0&&jQuery(c).css("position",c.dragCfg.oP);c.si&&jQuery.iDrag.helper.css("cursor","move");c.dragCfg.frameClass&&jQuery.iDrag.helper.removeClass(c.dragCfg.frameClass);if(c.dragCfg.revert==!1){if(c.dragCfg.fx>0)(!c.dragCfg.axis||c.dragCfg.axis=="horizontally")&&(new jQuery.fx(c,{duration:c.dragCfg.fx},"left")).custom(c.dragCfg.oR.x,
c.dragCfg.nRx),(!c.dragCfg.axis||c.dragCfg.axis=="vertically")&&(new jQuery.fx(c,{duration:c.dragCfg.fx},"top")).custom(c.dragCfg.oR.y,c.dragCfg.nRy);else{if(!c.dragCfg.axis||c.dragCfg.axis=="horizontally")c.style.left=c.dragCfg.nRx+"px";if(!c.dragCfg.axis||c.dragCfg.axis=="vertically")c.style.top=c.dragCfg.nRy+"px"}jQuery.iDrag.hidehelper(c);c.dragCfg.ghosting==!1&&jQuery(c).css("display",c.dragCfg.oD)}else if(c.dragCfg.fx>0){c.dragCfg.prot=!0;var e=!1;jQuery.iDrop&&jQuery.iSort&&c.dragCfg.so&&(e=
jQuery.iUtil.getPosition(jQuery.iSort.helper.get(0)));jQuery.iDrag.helper.animate({left:e?e.x:c.dragCfg.oC.x,top:e?e.y:c.dragCfg.oC.y},c.dragCfg.fx,function(){c.dragCfg.prot=!1;if(c.dragCfg.ghosting==!1)c.style.display=c.dragCfg.oD;jQuery.iDrag.hidehelper(c)})}else jQuery.iDrag.hidehelper(c),c.dragCfg.ghosting==!1&&jQuery(c).css("display",c.dragCfg.oD);jQuery.iDrop&&jQuery.iDrop.count>0&&jQuery.iDrop.checkdrop(c);jQuery.iSort&&c.dragCfg.so&&jQuery.iSort.check(c);if(c.dragCfg.onChange&&(c.dragCfg.nRx!=
c.dragCfg.oR.x||c.dragCfg.nRy!=c.dragCfg.oR.y))c.dragCfg.onChange.apply(c,c.dragCfg.lastSi||[0,0,c.dragCfg.nRx,c.dragCfg.nRy]);c.dragCfg.onStop&&c.dragCfg.onStop.apply(c);return!1}},snapToGrid:function(c,e,d,f){d!=0&&(d=parseInt((d+this.dragCfg.gx*d/Math.abs(d)/2)/this.dragCfg.gx)*this.dragCfg.gx);f!=0&&(f=parseInt((f+this.dragCfg.gy*f/Math.abs(f)/2)/this.dragCfg.gy)*this.dragCfg.gy);return{dx:d,dy:f,x:0,y:0}},fitToContainer:function(c,e,d,f){d=Math.min(Math.max(d,this.dragCfg.cont.dx),this.dragCfg.cont.w+
this.dragCfg.cont.dx-this.dragCfg.oC.wb);f=Math.min(Math.max(f,this.dragCfg.cont.dy),this.dragCfg.cont.h+this.dragCfg.cont.dy-this.dragCfg.oC.hb);return{dx:d,dy:f,x:0,y:0}},dragmove:function(c){if(!(jQuery.iDrag.dragged==null||jQuery.iDrag.dragged.dragCfg.prot==!0)){var e=jQuery.iDrag.dragged;e.dragCfg.currentPointer=jQuery.iUtil.getPointer(c);if(e.dragCfg.init==!1)if(distance=Math.sqrt(Math.pow(e.dragCfg.pointer.x-e.dragCfg.currentPointer.x,2)+Math.pow(e.dragCfg.pointer.y-e.dragCfg.currentPointer.y,
2)),distance<e.dragCfg.snapDistance)return;else jQuery.iDrag.dragstart(c);var c=e.dragCfg.currentPointer.x-e.dragCfg.pointer.x,d=e.dragCfg.currentPointer.y-e.dragCfg.pointer.y,f;for(f in e.dragCfg.onDragModifier){var g=e.dragCfg.onDragModifier[f].apply(e,[e.dragCfg.oR.x+c,e.dragCfg.oR.y+d,c,d]);g&&g.constructor==Object&&(c=f!="user"?g.dx:g.x-e.dragCfg.oR.x,d=f!="user"?g.dy:g.y-e.dragCfg.oR.y)}e.dragCfg.nx=e.dragCfg.oC.x+c-e.dragCfg.diffX;e.dragCfg.ny=e.dragCfg.oC.y+d-e.dragCfg.diffY;if(e.dragCfg.si&&
(e.dragCfg.onSlide||e.dragCfg.onChange))jQuery.iSlider.onSlide(e,e.dragCfg.nx,e.dragCfg.ny);e.dragCfg.onDrag&&e.dragCfg.onDrag.apply(e,[e.dragCfg.oR.x+c,e.dragCfg.oR.y+d]);if(!e.dragCfg.axis||e.dragCfg.axis=="horizontally")e.dragCfg.nRx=e.dragCfg.oR.x+c,jQuery.iDrag.helper.get(0).style.left=e.dragCfg.nx+"px";if(!e.dragCfg.axis||e.dragCfg.axis=="vertically")e.dragCfg.nRy=e.dragCfg.oR.y+d,jQuery.iDrag.helper.get(0).style.top=e.dragCfg.ny+"px";jQuery.iDrop&&jQuery.iDrop.count>0&&jQuery.iDrop.checkhover(e);
return!1}},build:function(c){if(!jQuery.iDrag.helper){jQuery("body",document).append('<div id="dragHelper"></div>');jQuery.iDrag.helper=jQuery("#dragHelper");var e=jQuery.iDrag.helper.get(0),d=e.style;d.position="absolute";d.display="none";d.cursor="move";d.listStyle="none";d.overflow="hidden";window.ActiveXObject?e.unselectable="on":(d.mozUserSelect="none",d.userSelect="none",d.KhtmlUserSelect="none")}c||(c={});return this.each(function(){if(!this.isDraggable&&jQuery.iUtil){if(window.ActiveXObject)this.onselectstart=
function(){return!1},this.ondragstart=function(){return!1};var d=this,e=jQuery.browser.msie&&typeof c.handle!="string"?jQuery(c.handle):c.handle?jQuery(c.handle+":first",this):jQuery(this);jQuery.browser.msie?e.each(function(){this.unselectable="on"}):(e.css("-moz-user-select","none"),e.css("user-select","none"),e.css("-khtml-user-select","none"));this.dragCfg={dhe:e,revert:c.revert?!0:!1,ghosting:c.ghosting?!0:!1,so:c.so?c.so:!1,si:c.si?c.si:!1,insideParent:c.insideParent?c.insideParent:!1,zIndex:c.zIndex?
parseInt(c.zIndex)||0:!1,opacity:c.opacity?parseFloat(c.opacity):!1,fx:parseInt(c.fx)||null,hpc:c.hpc?c.hpc:!1,onDragModifier:{},pointer:{},onStart:c.onStart&&c.onStart.constructor==Function?c.onStart:!1,onStop:c.onStop&&c.onStop.constructor==Function?c.onStop:!1,onChange:c.onChange&&c.onChange.constructor==Function?c.onChange:!1,axis:/vertically|horizontally/.test(c.axis)?c.axis:!1,snapDistance:c.snapDistance?parseInt(c.snapDistance)||0:0,cursorAt:c.cursorAt?c.cursorAt:!1,autoSize:c.autoSize?!0:
!1,frameClass:c.frameClass||!1};if(c.onDragModifier&&c.onDragModifier.constructor==Function)this.dragCfg.onDragModifier.user=c.onDragModifier;if(c.onDrag&&c.onDrag.constructor==Function)this.dragCfg.onDrag=c.onDrag;if(c.containment&&(c.containment.constructor==String&&(c.containment=="parent"||c.containment=="document")||c.containment.constructor==Array&&c.containment.length==4))this.dragCfg.containment=c.containment;if(c.fractions)this.dragCfg.fractions=c.fractions;if(c.grid)if(typeof c.grid=="number")this.dragCfg.gx=
parseInt(c.grid)||1,this.dragCfg.gy=parseInt(c.grid)||1;else if(c.grid.length==2)this.dragCfg.gx=parseInt(c.grid[0])||1,this.dragCfg.gy=parseInt(c.grid[1])||1;if(c.onSlide&&c.onSlide.constructor==Function)this.dragCfg.onSlide=c.onSlide;this.isDraggable=!0;e.each(function(){this.dragElem=d});e.bind("mousedown",jQuery.iDrag.draginit)}})}};jQuery.fn.extend({DraggableDestroy:jQuery.iDrag.destroy,Draggable:jQuery.iDrag.build});var DRAG_ITEM_HEIGHT=29;
jQuery.iDrop={fit:function(c,e,d,f){return c<=jQuery.iDrag.dragged.dragCfg.nx&&c+d>=jQuery.iDrag.dragged.dragCfg.nx+jQuery.iDrag.dragged.dragCfg.oC.w&&e<=jQuery.iDrag.dragged.dragCfg.ny&&e+f>=jQuery.iDrag.dragged.dragCfg.ny+jQuery.iDrag.dragged.dragCfg.oC.h?!0:!1},intersect:function(c,e,d,f){return!(c>jQuery.iDrag.dragged.dragCfg.nx+jQuery.iDrag.dragged.dragCfg.oC.w||c+d<jQuery.iDrag.dragged.dragCfg.nx||e>jQuery.iDrag.dragged.dragCfg.ny+DRAG_ITEM_HEIGHT||e+f<jQuery.iDrag.dragged.dragCfg.ny)?!0:!1},
pointer:function(c,e,d,f){return c<jQuery.iDrag.dragged.dragCfg.currentPointer.x&&c+d>jQuery.iDrag.dragged.dragCfg.currentPointer.x&&e<jQuery.iDrag.dragged.dragCfg.currentPointer.y&&e+f>jQuery.iDrag.dragged.dragCfg.currentPointer.y?!0:!1},overzone:!1,highlighted:{},count:0,zones:{},highlight:function(c){if(jQuery.iDrag.dragged!=null){var e;jQuery.iDrop.highlighted={};var d=!1;for(e in jQuery.iDrop.zones)if(jQuery.iDrop.zones[e]!=null){var f=jQuery.iDrop.zones[e].get(0);if(jQuery(jQuery.iDrag.dragged).is("."+
f.dropCfg.a)){if(f.dropCfg.m==!1)f.dropCfg.p=jQuery.extend(jQuery.iUtil.getPositionLite(f),jQuery.iUtil.getSizeLite(f)),f.dropCfg.m=!0;f.dropCfg.ac&&jQuery.iDrop.zones[e].addClass(f.dropCfg.ac);jQuery.iDrop.highlighted[e]=jQuery.iDrop.zones[e];if(jQuery.iSort&&f.dropCfg.s&&jQuery.iDrag.dragged.dragCfg.so)f.dropCfg.el=jQuery("."+f.dropCfg.a,f),c.style.display="none",jQuery.iSort.measure(f),f.dropCfg.os=jQuery.iSort.serialize(jQuery.attr(f,"id")).hash,c.style.display=c.dragCfg.oD,d=!0;f.dropCfg.onActivate&&
f.dropCfg.onActivate.apply(jQuery.iDrop.zones[e].get(0),[jQuery.iDrag.dragged])}}d&&jQuery.iSort.start()}},remeasure:function(){jQuery.iDrop.highlighted={};for(i in jQuery.iDrop.zones)if(jQuery.iDrop.zones[i]!=null){var c=jQuery.iDrop.zones[i].get(0);if(jQuery(jQuery.iDrag.dragged).is("."+c.dropCfg.a)&&(c.dropCfg.p=jQuery.extend(jQuery.iUtil.getPositionLite(c),jQuery.iUtil.getSizeLite(c)),c.dropCfg.ac&&jQuery.iDrop.zones[i].addClass(c.dropCfg.ac),jQuery.iDrop.highlighted[i]=jQuery.iDrop.zones[i],
jQuery.iSort&&c.dropCfg.s&&jQuery.iDrag.dragged.dragCfg.so))c.dropCfg.el=jQuery("."+c.dropCfg.a,c),jQuery.iSort.measure(c)}},checkhover:function(c){if(jQuery.iDrag.dragged!=null){jQuery.iDrop.overzone=!1;var e,d=!1,f=0;for(e in jQuery.iDrop.highlighted){var g=jQuery.iDrop.highlighted[e].get(0),h=jQuery.iDrop[g.dropCfg.t](g.dropCfg.p.x,g.dropCfg.p.y,g.dropCfg.p.wb,g.dropCfg.p.hb);if(jQuery.iDrop.overzone==!1&&h){g.dropCfg.hc&&g.dropCfg.h==!1&&jQuery.iDrop.highlighted[e].addClass(g.dropCfg.hc);g.dropCfg.h==
!1&&g.dropCfg.onHover&&(d=!0);g.dropCfg.h=!0;jQuery.iDrop.overzone=g;if(jQuery.iSort&&g.dropCfg.s&&jQuery.iDrag.dragged.dragCfg.so)jQuery.iSort.helper.get(0).className=g.dropCfg.shc,jQuery.iSort.checkhover(g);f++}else if(g.dropCfg.h==!0)g.dropCfg.onOut&&g.dropCfg.onOut.apply(g,[c,jQuery.iDrag.helper.get(0).firstChild,g.dropCfg.fx]),g.dropCfg.hc&&jQuery.iDrop.highlighted[e].removeClass(g.dropCfg.hc),g.dropCfg.h=!1}if(jQuery.iSort&&!jQuery.iDrop.overzone&&jQuery.iDrag.dragged.so)jQuery.iSort.helper.get(0).style.display=
"none";d&&jQuery.iDrop.overzone.dropCfg.onHover.apply(jQuery.iDrop.overzone,[c,jQuery.iDrag.helper.get(0).firstChild])}},checkdrop:function(c){for(var e in jQuery.iDrop.highlighted){var d=jQuery.iDrop.highlighted[e].get(0);d.dropCfg.ac&&jQuery.iDrop.highlighted[e].removeClass(d.dropCfg.ac);d.dropCfg.hc&&jQuery.iDrop.highlighted[e].removeClass(d.dropCfg.hc);d.dropCfg.s&&(jQuery.iSort.changed[jQuery.iSort.changed.length]=e);if(d.dropCfg.onDrop&&d.dropCfg.h==!0)d.dropCfg.h=!1,d.dropCfg.onDrop.apply(d,
[c,d.dropCfg.fx]);d.dropCfg.m=!1;d.dropCfg.h=!1}jQuery.iDrop.highlighted={}},destroy:function(){return this.each(function(){if(this.isDroppable)this.dropCfg.s&&(id=jQuery.attr(this,"id"),jQuery.iSort.collected[id]=null,jQuery("."+this.dropCfg.a,this).DraggableDestroy()),jQuery.iDrop.zones["d"+this.idsa]=null,this.isDroppable=!1,this.f=null})},build:function(c){return this.each(function(){if(!(this.isDroppable==!0||!c.accept||!jQuery.iUtil||!jQuery.iDrag)){this.dropCfg={a:c.accept,ac:c.activeclass||
!1,hc:c.hoverclass||!1,shc:c.helperclass||!1,onDrop:c.ondrop||c.onDrop||!1,onHover:c.onHover||c.onhover||!1,onOut:c.onOut||c.onout||!1,onActivate:c.onActivate||!1,t:c.tolerance&&(c.tolerance=="fit"||c.tolerance=="intersect")?c.tolerance:"pointer",fx:c.fx?c.fx:!1,m:!1,h:!1};if(c.sortable==!0&&jQuery.iSort&&(id=jQuery.attr(this,"id"),jQuery.iSort.collected[id]=this.dropCfg.a,this.dropCfg.s=!0,c.onChange))this.dropCfg.onChange=c.onChange,this.dropCfg.os=jQuery.iSort.serialize(id).hash;this.isDroppable=
!0;this.idsa=parseInt(Math.random()*1E4);jQuery.iDrop.zones["d"+this.idsa]=jQuery(this);jQuery.iDrop.count++}})}};jQuery.fn.extend({DroppableDestroy:jQuery.iDrop.destroy,Droppable:jQuery.iDrop.build});jQuery.recallDroppables=jQuery.iDrop.remeasure;jQuery.iSort={changed:[],collected:{},helper:!1,inFrontOf:null,start:function(){if(jQuery.iDrag.dragged!=null){var c,e;jQuery.iSort.helper.get(0).className=jQuery.iDrag.dragged.dragCfg.hpc;c=jQuery.iSort.helper.get(0).style;c.display="block";jQuery.iSort.helper.oC=jQuery.extend(jQuery.iUtil.getPosition(jQuery.iSort.helper.get(0)),jQuery.iUtil.getSize(jQuery.iSort.helper.get(0)));c.width=jQuery.iDrag.dragged.dragCfg.oC.wb-2+"px";c.height=jQuery.iDrag.dragged.dragCfg.oC.hb-2+"px";e=jQuery.iUtil.getMargins(jQuery.iDrag.dragged);
c.marginTop=e.t;c.marginRight=e.r;c.marginBottom=e.b;c.marginLeft=e.l;if(jQuery.iDrag.dragged.dragCfg.ghosting==!0)c=jQuery.iDrag.dragged.cloneNode(!0),e=c.style,e.marginTop="0px",e.marginRight="0px",e.marginBottom="0px",e.marginLeft="0px",e.display="block",jQuery.iSort.helper.empty().append(c);jQuery(jQuery.iDrag.dragged).after(jQuery.iSort.helper.get(0));jQuery.iDrag.dragged.style.display="none"}},check:function(c){!c.dragCfg.so&&jQuery.iDrop.overzone.sortable&&(c.dragCfg.onStop&&c.dragCfg.onStop.apply(dragged),
jQuery(c).css("position",c.dragCfg.initialPosition||c.dragCfg.oP),jQuery(c).DraggableDestroy(),jQuery(jQuery.iDrop.overzone).SortableAddItem(c));jQuery.iSort.helper.removeClass(c.dragCfg.hpc).html("&nbsp;");jQuery.iSort.inFrontOf=null;jQuery.iSort.helper.get(0).style.display="none";jQuery.iSort.helper.after(c);c.dragCfg.fx>0&&jQuery(c).fadeIn(c.dragCfg.fx);jQuery("body").append(jQuery.iSort.helper.get(0));for(var c=[],e=!1,d=0;d<jQuery.iSort.changed.length;d++){var f=jQuery.iDrop.zones[jQuery.iSort.changed[d]].get(0),
g=jQuery.attr(f,"id"),h=jQuery.iSort.serialize(g);if(f.dropCfg.os!=h.hash){f.dropCfg.os=h.hash;if(e==!1&&f.dropCfg.onChange)e=f.dropCfg.onChange;h.id=g;c[c.length]=h}}jQuery.iSort.changed=[];e!=!1&&c.length>0&&e(c)},checkhover:function(c){if(jQuery.iDrag.dragged){var e=!1,d=0;if(c.dropCfg.el.size()>0)for(d=c.dropCfg.el.size();d>0;d--)if(c.dropCfg.el.get(d-1)!=jQuery.iDrag.dragged)if(c.sortCfg.floats)c.dropCfg.el.get(d-1).pos.x+c.dropCfg.el.get(d-1).pos.wb/2>jQuery.iDrag.dragged.dragCfg.nx&&c.dropCfg.el.get(d-
1).pos.y+c.dropCfg.el.get(d-1).pos.hb/2>jQuery.iDrag.dragged.dragCfg.ny&&(e=c.dropCfg.el.get(d-1));else if(c.dropCfg.el.get(d-1).pos.y+c.dropCfg.el.get(d-1).pos.hb/2>jQuery.iDrag.dragged.dragCfg.ny)e=c.dropCfg.el.get(d-1);else break;if(e&&jQuery.iSort.inFrontOf!=e)jQuery.iSort.inFrontOf=e,jQuery(e).before(jQuery.iSort.helper.get(0));else if(!e&&(jQuery.iSort.inFrontOf!=null||jQuery.iSort.helper.get(0).parentNode!=c))jQuery.iSort.inFrontOf=null,jQuery(c).append(jQuery.iSort.helper.get(0));jQuery.iSort.helper.get(0).style.display=
"block"}},measure:function(c){jQuery.iDrag.dragged!=null&&c.dropCfg.el.each(function(){this.pos=jQuery.extend(jQuery.iUtil.getSizeLite(this),jQuery.iUtil.getPositionLite(this))})},serialize:function(c){var e,d="",f={};if(c)if(jQuery.iSort.collected[c])f[c]=[],jQuery("#"+c+" ."+jQuery.iSort.collected[c]).each(function(){d.length>0&&(d+="&");d+=c+"[]="+jQuery.attr(this,"id");f[c][f[c].length]=jQuery.attr(this,"id")});else for(a in c)jQuery.iSort.collected[c[a]]&&(f[c[a]]=[],jQuery("#"+c[a]+" ."+jQuery.iSort.collected[c[a]]).each(function(){d.length>
0&&(d+="&");d+=c[a]+"[]="+jQuery.attr(this,"id");f[c[a]][f[c[a]].length]=jQuery.attr(this,"id")}));else for(e in jQuery.iSort.collected)f[e]=[],jQuery("#"+e+" ."+jQuery.iSort.collected[e]).each(function(){d.length>0&&(d+="&");d+=e+"[]="+jQuery.attr(this,"id");f[e][f[e].length]=jQuery.attr(this,"id")});return{hash:d,o:f}},addItem:function(c){if(c.childNodes)return this.each(function(){(!this.sortCfg||!jQuery(c).is("."+this.sortCfg.accept))&&jQuery(c).addClass(this.sortCfg.accept);jQuery(c).Draggable(this.sortCfg.dragCfg)})},
destroy:function(){return this.each(function(){jQuery("."+this.sortCfg.accept).DraggableDestroy();jQuery(this).DroppableDestroy();this.isSortable=this.sortCfg=null})},build:function(c){if(c.accept&&jQuery.iUtil&&jQuery.iDrag&&jQuery.iDrop){if(!jQuery.iSort.helper)jQuery("body",document).append('<div id="sortHelper">&nbsp;</div>'),jQuery.iSort.helper=jQuery("#sortHelper"),jQuery.iSort.helper.get(0).style.display="none";this.Droppable({accept:c.accept,activeclass:c.activeclass?c.activeclass:!1,hoverclass:c.hoverclass?
c.hoverclass:!1,helperclass:c.helperclass?c.helperclass:!1,onHover:c.onHover||c.onhover,onOut:c.onOut||c.onout,sortable:!0,onChange:c.onChange||c.onchange,fx:c.fx?c.fx:!1,ghosting:c.ghosting?!0:!1,tolerance:c.tolerance?c.tolerance:"intersect"});return this.each(function(){var e={revert:c.revert?!0:!1,zindex:3E3,opacity:c.opacity?parseFloat(c.opacity):!1,hpc:c.helperclass?c.helperclass:!1,fx:c.fx?c.fx:!1,so:!0,ghosting:c.ghosting?!0:!1,handle:c.handle?c.handle:null,containment:c.containment?c.containment:
null,onStart:c.onStart&&c.onStart.constructor==Function?c.onStart:!1,onDrag:c.onDrag&&c.onDrag.constructor==Function?c.onDrag:!1,onStop:c.onStop&&c.onStop.constructor==Function?c.onStop:!1,axis:/vertically|horizontally/.test(c.axis)?c.axis:!1,snapDistance:c.snapDistance?parseInt(c.snapDistance)||0:!1,cursorAt:c.cursorAt?c.cursorAt:!1};jQuery("."+c.accept,this).Draggable(e);this.isSortable=!0;this.sortCfg={accept:c.accept,revert:c.revert?!0:!1,zindex:3E3,opacity:c.opacity?parseFloat(c.opacity):!1,
hpc:c.helperclass?c.helperclass:!1,fx:c.fx?c.fx:!1,so:!0,ghosting:c.ghosting?!0:!1,handle:c.handle?c.handle:null,containment:c.containment?c.containment:null,floats:c.floats?!0:!1,dragCfg:e}})}}};jQuery.fn.extend({Sortable:jQuery.iSort.build,SortableAddItem:jQuery.iSort.addItem,SortableDestroy:jQuery.iSort.destroy});jQuery.SortSerialize=jQuery.iSort.serialize;jQuery.iUtil={getPosition:function(c){var e=0,d=0,f=c.style,g=!1;if(jQuery(c).css("display")=="none"){var h=f.visibility,j=f.position,g=!0;f.visibility="hidden";f.display="block";f.position="absolute"}for(var k=c;k;)e+=k.offsetLeft+(k.currentStyle&&!jQuery.browser.opera?parseInt(k.currentStyle.borderLeftWidth)||0:0),d+=k.offsetTop+(k.currentStyle&&!jQuery.browser.opera?parseInt(k.currentStyle.borderTopWidth)||0:0),k=k.offsetParent;for(k=c;k&&k.tagName&&k.tagName.toLowerCase()!="body";)e-=k.scrollLeft||
0,d-=k.scrollTop||0,k=k.parentNode;if(g==!0)f.display="none",f.position=j,f.visibility=h;return{x:e,y:d}},getPositionLite:function(c){for(var e=0,d=0;c;)e+=c.offsetLeft||0,d+=c.offsetTop||0,c=c.offsetParent;return{x:e,y:d}},getSize:function(c){var e=$(c).width(),d=$(c).height(),f=0,g=0,h=c.style;if(jQuery(c).css("display")!="none")f=c.offsetWidth,g=c.offsetHeight;else{var j=h.visibility,k=h.position;h.visibility="hidden";h.display="block";h.position="absolute";f=c.offsetWidth;g=c.offsetHeight;h.display=
"none";h.position=k;h.visibility=j}return{w:e,h:d,wb:f,hb:g}},getSizeLite:function(c){return{wb:c.offsetWidth||0,hb:c.offsetHeight||0}},getClient:function(c){var e;c?(e=c.clientWidth,c=c.clientHeight):(c=document.documentElement,e=window.innerWidth||self.innerWidth||c&&c.clientWidth||document.body.clientWidth,c=window.innerHeight||self.innerHeight||c&&c.clientHeight||document.body.clientHeight);return{w:e,h:c}},getScroll:function(c){var e=0,d=0,f=0,g=0,h=0,j=0;if(c&&c.nodeName.toLowerCase()!="body")e=
c.scrollTop,d=c.scrollLeft,f=c.scrollWidth,g=c.scrollHeight,j=h=0;else{if(document.documentElement)e=document.documentElement.scrollTop,d=document.documentElement.scrollLeft,f=document.documentElement.scrollWidth,g=document.documentElement.scrollHeight;else if(document.body)e=document.body.scrollTop,d=document.body.scrollLeft,f=document.body.scrollWidth,g=document.body.scrollHeight;h=self.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0;j=self.innerHeight||document.documentElement.clientHeight||
document.body.clientHeight||0}return{t:e,l:d,w:f,h:g,iw:h,ih:j}},getMargins:function(c,e){var d=jQuery(c),f=d.css("marginTop")||"",g=d.css("marginRight")||"",h=d.css("marginBottom")||"",d=d.css("marginLeft")||"";return e?{t:parseInt(f)||0,r:parseInt(g)||0,b:parseInt(h)||0,l:parseInt(d)}:{t:f,r:g,b:h,l:d}},getPadding:function(c,e){var d=jQuery(c),f=d.css("paddingTop")||"",g=d.css("paddingRight")||"",h=d.css("paddingBottom")||"",d=d.css("paddingLeft")||"";return e?{t:parseInt(f)||0,r:parseInt(g)||0,
b:parseInt(h)||0,l:parseInt(d)}:{t:f,r:g,b:h,l:d}},getBorder:function(c,e){var d=jQuery(c),f=d.css("borderTopWidth")||"",g=d.css("borderRightWidth")||"",h=d.css("borderBottomWidth")||"",d=d.css("borderLeftWidth")||"";return e?{t:parseInt(f)||0,r:parseInt(g)||0,b:parseInt(h)||0,l:parseInt(d)||0}:{t:f,r:g,b:h,l:d}},getPointer:function(c){return{x:c.pageX||c.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)||0,y:c.pageY||c.clientY+(document.documentElement.scrollTop||document.body.scrollTop)||
0}},traverseDOM:function(c,e){e(c);for(c=c.firstChild;c;)jQuery.iUtil.traverseDOM(c,e),c=c.nextSibling},purgeEvents:function(c){jQuery.iUtil.traverseDOM(c,function(c){for(var d in c)typeof c[d]==="function"&&(c[d]=null)})},centerEl:function(c,e){var d=jQuery.iUtil.getScroll(),f=jQuery.iUtil.getSize(c);(!e||e=="vertically")&&jQuery(c).css({top:d.t+(Math.max(d.h,d.ih)-d.t-f.hb)/2+"px"});(!e||e=="horizontally")&&jQuery(c).css({left:d.l+(Math.max(d.w,d.iw)-d.l-f.wb)/2+"px"})},fixPNG:function(c,e){var d;
jQuery('img[@src*="png"]',c||document).each(function(){d=this.src;this.src=e;this.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+d+"')"})}};[].indexOf||(Array.prototype.indexOf=function(c,e){for(var d=this.length,f=e==null?0:e;f<d;f++)if(this[f]==c)return f;return-1});jQuery.iNestedSortable={checkHover:function(c,e){return c.isNestedSortable?(jQuery.iNestedSortable.scroll(c),jQuery.iNestedSortable.newCheckHover(c)):jQuery.iNestedSortable.oldCheckHover(c,e)},oldCheckHover:jQuery.iSort.checkhover,newCheckHover:function(c){if(jQuery.iDrag.dragged&&c.dropCfg.el.size()>0){if(!c.nestedSortCfg.remeasured)jQuery.iSort.measure(c),c.nestedSortCfg.remeasured=!0;var e=jQuery.iNestedSortable.findPrecedingItem(c),d=jQuery.iNestedSortable.shouldNestItem(c,e),f=!e?jQuery.iNestedSortable.isTouchingFirstItem(c):
!1,g=!1,h=jQuery.iNestedSortable.findCurrentItem(c);if(c.nestedSortCfg.dropableType!=void 0&&$(jQuery.iDrag.dragged).hasClass(c.nestedSortCfg.dropableType))h!=null&&h.pos.y+30>jQuery.iDrag.dragged.dragCfg.ny?(liDiv=$(h).find(".LiDiv:first"),previousHoverElement!=void 0&&previousHoverElement!=liDiv&&previousHoverElement.removeClass("ProjectSelectedMoveItem"),previousHoverElement!=liDiv&&(liDiv.addClass("ProjectSelectedMoveItem"),previousHoverElement=liDiv)):previousHoverElement!=void 0&&(previousHoverElement.removeClass("ProjectSelectedMoveItem"),
previousHoverElement=void 0);else if(previousHoverElement!=void 0&&(previousHoverElement.removeClass("ProjectSelectedMoveItem"),previousHoverElement=void 0),c.nestedSortCfg.allowReorder)e?c.nestedSortCfg.lastPrecedingItem===e&&c.nestedSortCfg.lastShouldNest===d&&(g=!0):c.nestedSortCfg.lastPrecedingItem===e&&c.nestedSortCfg.lastTouchingFirst===f&&(g=!0),c.nestedSortCfg.lastPrecedingItem=e,c.nestedSortCfg.lastShouldNest=d,c.nestedSortCfg.lastTouchingFirst=f,g||(e!==null?d?jQuery.iNestedSortable.nestItem(c,
e):jQuery.iNestedSortable.appendItem(c,e):f&&jQuery.iNestedSortable.insertOnTop(c))}},scroll:function(c){if(!c.nestedSortCfg.autoScroll)return!1;var e=c.nestedSortCfg.scrollSensitivity,c=c.nestedSortCfg.scrollSpeed,d=jQuery.iDrag.dragged.dragCfg.currentPointer,f=jQuery.iUtil.getScroll();d.y-f.ih-f.t>-e&&window.scrollBy(0,c);d.y-f.t<e&&window.scrollBy(0,-c)},check:function(c){jQuery.iNestedSortable.newCheck(c);return jQuery.iNestedSortable.oldCheck(c)},oldCheck:jQuery.iSort.check,newCheck:function(){if(jQuery.iNestedSortable.latestNestingClass&&
jQuery.iNestedSortable.currentNesting)jQuery.iNestedSortable.currentNesting.removeClass(jQuery.iNestedSortable.latestNestingClass),jQuery.iNestedSortable.currentNesting=null,jQuery.iNestedSortable.latestNestingClass="";if(jQuery.iDrop.overzone.isNestedSortable)jQuery.iDrop.overzone.nestedSortCfg.remeasured=!1},serialize:function(c){return jQuery("#"+c).get(0).isNestedSortable?jQuery.iNestedSortable.newSerialize(c):jQuery.iNestedSortable.oldSerialize(c)},oldSerialize:jQuery.iSort.serialize,newSerialize:function(c){var e,
d="",f="",g={},h,j=function(e){var g=[];thisChildren=jQuery(e).children("."+jQuery.iSort.collected[c]);thisChildren.each(function(e){var k=jQuery.attr(this,"id");k&&k.match&&(k=k.match(h.nestedSortCfg.serializeRegExp)[0]);d.length>0&&(d+="&");d+=c+f+"["+e+"][id]="+k;g[e]={id:k};var n=jQuery(this).children(h.nestedSortCfg.nestingTag+"."+h.nestedSortCfg.nestingTagClass.split(" ").join(".")).get(0),k=f;f+="["+e+"][children]";n=j(n);if(n.length>0)g[e].children=n;f=k});return g};if(c)if(jQuery.iSort.collected[c])h=
jQuery("#"+c).get(0),g[c]=j(h);else for(a in c)jQuery.iSort.collected[c[a]]&&(h=jQuery("#"+c[a]).get(0),g[c[a]]=j(h));else for(e in jQuery.iSort.collected)h=jQuery("#"+e).get(0),g[e]=j(h);return{hash:d,o:g}},findPrecedingItem:function(c){var e=0,d=jQuery.grep(c.dropCfg.el,function(d){if(!(d.pos.y<jQuery.iDrag.dragged.dragCfg.ny&&d.pos.y>e))return!1;if(!(c.nestedSortCfg.rightToLeft?d.pos.x+d.pos.wb+c.nestedSortCfg.snapTolerance>jQuery.iDrag.dragged.dragCfg.nx+jQuery.iDrag.dragged.dragCfg.oC.wb:d.pos.x-
c.nestedSortCfg.snapTolerance<jQuery.iDrag.dragged.dragCfg.nx))return!1;if(jQuery.iNestedSortable.isBeingDragged(c,d))return!1;e=d.pos.y;return!0});return d.length>0?d[d.length-1]:null},findCurrentItem:function(c){var e=0,d=jQuery.grep(c.dropCfg.el,function(d){var g=d.pos.y-15;if(!(g<jQuery.iDrag.dragged.dragCfg.ny&&g>e))return!1;if(!(c.nestedSortCfg.rightToLeft?d.pos.x+d.pos.wb+c.nestedSortCfg.snapTolerance>jQuery.iDrag.dragged.dragCfg.nx+jQuery.iDrag.dragged.dragCfg.oC.wb:d.pos.x-c.nestedSortCfg.snapTolerance<
jQuery.iDrag.dragged.dragCfg.nx))return!1;if(jQuery.iNestedSortable.isBeingDragged(c,d))return!1;e=g;return!0});return d.length>0?d[d.length-1]:null},isTouchingFirstItem:function(c){var e,d=jQuery.grep(c.dropCfg.el,function(d){if(!(e===void 0||d.pos.y<e))return!1;if(jQuery.iNestedSortable.isBeingDragged(c,d))return!1;e=d.pos.y;return!0});return d.length>0?(d=d[0],d.pos.y<jQuery.iDrag.dragged.dragCfg.ny+jQuery.iDrag.dragged.dragCfg.oC.hb&&d.pos.y>jQuery.iDrag.dragged.dragCfg.ny):!1},isBeingDragged:function(c,
e){var d=jQuery.iDrag.dragged;if(!d)return!1;if(e==d)return!0;return jQuery(e).parents("."+c.sortCfg.accept.split(" ").join(".")).filter(function(){return this==d}).length!==0?!0:!1},shouldNestItem:function(c,e){if(!e)return!1;if(c.nestedSortCfg.noNestingClass&&jQuery(e).filter("."+c.nestedSortCfg.noNestingClass).get(0)===e)return!1;return c.nestedSortCfg.rightToLeft?e.pos.x+e.pos.wb-(c.nestedSortCfg.nestingPxSpace-c.nestedSortCfg.snapTolerance)>jQuery.iDrag.dragged.dragCfg.nx+jQuery.iDrag.dragged.dragCfg.oC.wb:
e.pos.x+(c.nestedSortCfg.nestingPxSpace-c.nestedSortCfg.snapTolerance)<jQuery.iDrag.dragged.dragCfg.nx},nestItem:function(c,e){var d=jQuery(e).children(c.nestedSortCfg.nestingTag+"."+c.nestedSortCfg.nestingTagClass.split(" ").join(".")),f=jQuery.iSort.helper;styleHelper=f.get(0).style;styleHelper.width="auto";d.size()||(d="<"+c.nestedSortCfg.nestingTag+" class='"+c.nestedSortCfg.nestingTagClass+"'></"+c.nestedSortCfg.nestingTag+">",d=jQuery(e).append(d).children(c.nestedSortCfg.nestingTag).css(c.nestedSortCfg.styleToAttach));
jQuery.iNestedSortable.updateCurrentNestingClass(c,d);jQuery.iNestedSortable.beforeHelperRemove(c);d.prepend(f.get(0));jQuery.iNestedSortable.afterHelperInsert(c)},appendItem:function(c,e){jQuery.iNestedSortable.updateCurrentNestingClass(c,jQuery(e).parent());jQuery.iNestedSortable.beforeHelperRemove(c);jQuery(e).after(jQuery.iSort.helper.get(0));jQuery.iNestedSortable.afterHelperInsert(c)},insertOnTop:function(c){jQuery.iNestedSortable.updateCurrentNestingClass(c,c);jQuery.iNestedSortable.beforeHelperRemove(c);
jQuery(c).prepend(jQuery.iSort.helper.get(0));jQuery.iNestedSortable.afterHelperInsert(c)},beforeHelperRemove:function(c){var e=jQuery.iSort.helper.parent(c.nestedSortCfg.nestingTag+"."+c.nestedSortCfg.nestingTagClass.split(" ").join("."));e.children("."+c.sortCfg.accept.split(" ").join(".")+":visible").size()===0&&e.get(0)!==c&&(e.hide(),jQuery.iDrop.remeasure())},afterHelperInsert:function(c){var e=jQuery.iSort.helper.parent();e.get(0)!==c&&(e.show(),jQuery.iDrop.remeasure());c.nestedSortCfg.remeasured=
!1},updateCurrentNestingClass:function(c,e){var d=jQuery(e);if(c.nestedSortCfg.currentNestingClass&&(!jQuery.iNestedSortable.currentNesting||d.get(0)!=jQuery.iNestedSortable.currentNesting.get(0)))jQuery.iNestedSortable.currentNesting&&jQuery.iNestedSortable.currentNesting.removeClass(c.nestedSortCfg.currentNestingClass),d.get(0)!=c?(jQuery.iNestedSortable.currentNesting=d,d.addClass(c.nestedSortCfg.currentNestingClass),jQuery.iNestedSortable.latestNestingClass=c.nestedSortCfg.currentNestingClass):
(jQuery.iNestedSortable.currentNesting=null,jQuery.iNestedSortable.latestNestingClass="")},destroy:function(){return this.each(function(){if(this.isNestedSortable)this.isNestedSortable=this.nestedSortCfg=null,jQuery(this).SortableDestroy()})},build:function(c){if(c.accept&&jQuery.iUtil&&jQuery.iDrag&&jQuery.iDrop&&jQuery.iSort)this.each(function(){this.isNestedSortable=!0;this.nestedSortCfg={noNestingClass:c.noNestingClass?c.noNestingClass:!1,rightToLeft:c.rightToLeft?!0:!1,nestingPxSpace:parseInt(c.nestingPxSpace,
10)||30,currentNestingClass:c.currentNestingClass?c.currentNestingClass:"",nestingLimit:c.nestingLimit?c.nestingLimit:!1,autoScroll:c.autoScroll!==void 0?c.autoScroll==!0:!0,scrollSensitivity:c.scrollSensitivity?c.scrollSensitivity:20,scrollSpeed:c.scrollSpeed?c.scrollSpeed:20,allowReorder:c.allowReorder!==void 0?c.allowReorder:!0,listType:c.listType,dropableType:c.dropableType,serializeRegExp:c.serializeRegExp?c.serializeRegExp:/[^\-]*$/};this.nestedSortCfg.snapTolerance=parseInt(this.nestedSortCfg.nestingPxSpace*
0.4,10);this.nestedSortCfg.nestingTag=this.tagName;this.nestedSortCfg.nestingTagClass=this.className;this.nestedSortCfg.styleToAttach=this.nestedSortCfg.rightToLeft?{"padding-left":0,"padding-right":this.nestedSortCfg.nestingPxSpace+"px"}:{"padding-left":this.nestedSortCfg.nestingPxSpace+"px","padding-right":0};jQuery(this.nestedSortCfg.nestingTag,this).css(this.nestedSortCfg.styleToAttach)}),jQuery.iSort.checkhover=jQuery.iNestedSortable.checkHover,jQuery.iSort.check=jQuery.iNestedSortable.check,
jQuery.iSort.serialize=jQuery.iNestedSortable.serialize;return this.Sortable(c)}};jQuery.fn.extend({NestedSortable:jQuery.iNestedSortable.build,NestedSortableDestroy:jQuery.iNestedSortable.destroy});
jQuery.iUtil.getScroll=function(c){var e,d,f,g,h;if(c&&c.nodeName.toLowerCase()!="body")e=c.scrollTop,d=c.scrollLeft,f=c.scrollWidth,g=c.scrollHeight,h=c=0;else{if(document.documentElement&&document.documentElement.scrollTop)e=document.documentElement.scrollTop,d=document.documentElement.scrollLeft,f=document.documentElement.scrollWidth,g=document.documentElement.scrollHeight;else if(document.body)e=document.body.scrollTop,d=document.body.scrollLeft,f=document.body.scrollWidth,g=document.body.scrollHeight;
c=self.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0;h=self.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0}return{t:e,l:d,w:f,h:g,iw:c,ih:h}};
